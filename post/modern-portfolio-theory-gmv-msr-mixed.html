<!DOCTYPE html><html lang="en-US"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-180222243-1"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-180222243-1', {
              page_path: window.location.pathname,
            });
          </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Modern Portfolio Theory - Part 2</title><meta name="description" content="Global Minimum Variance (GMV), Maximum Sharpe Ratio (MSR), Capital Allocation Line (Cal) and the mixed portfolio."/><meta property="og:type" content="website"/><meta name="og:title" property="og:title" content="Modern Portfolio Theory - Part 2"/><meta name="og:description" property="og:description" content="Global Minimum Variance (GMV), Maximum Sharpe Ratio (MSR), Capital Allocation Line (Cal) and the mixed portfolio."/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Modern Portfolio Theory - Part 2"/><meta name="twitter:description" content="Global Minimum Variance (GMV), Maximum Sharpe Ratio (MSR), Capital Allocation Line (Cal) and the mixed portfolio."/><meta name="twitter:creator" content="investingsnipts"/><link rel="icon" type="image/png" href="/static/favicon.ico"/><link rel="apple-touch-icon" href="/static/favicon.ico"/><meta name="next-head-count" content="13"/><link rel="preload" href="/_next/static/css/2d2f87205aa6ef8b4f4a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2d2f87205aa6ef8b4f4a.css" data-n-g=""/><link rel="preload" href="/_next/static/css/276cb3c5109fbc96253b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/276cb3c5109fbc96253b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/68cca870bc3fca5c9cb8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/68cca870bc3fca5c9cb8.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-9b805fa25f3c727dff23.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-eb080e3f091731f228fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1d36bc031662b4dc4c28.js" as="script"/><link rel="preload" href="/_next/static/chunks/aafb98ef.d6f2610c02ca1f2f8023.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.8953387921da877f7077.js" as="script"/><link rel="preload" href="/_next/static/chunks/c993a675fc23e2c5b16b0cdfa51e09fd2f5f8f80.b94a6da2562f8dbfcbf3.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-8d389892d8851416e9e3.js" as="script"/><link rel="preload" href="/_next/static/chunks/cb1608f2.374587486deb2a784e19.js" as="script"/><link rel="preload" href="/_next/static/chunks/a9a7754c.d9f31489d713bac24f81.js" as="script"/><link rel="preload" href="/_next/static/chunks/60273576.45a211ac3b19a5bdcfc0.js" as="script"/><link rel="preload" href="/_next/static/chunks/28b78d933298d505941537c6c1190f6a19d63af1.0f80399fe1f963dbc23b.js" as="script"/><link rel="preload" href="/_next/static/chunks/f485e41bcb118a628b46c21556cf62824a9a6265.b5d54d4427b3ca2aa455.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/post/%5Bslug%5D-c295bfa18e28c0faf5ff.js" as="script"/></head><body><div id="__next"><div class="overflow-hidden items-center justify-center bg-gray-100 max-w-screen-xl mx-auto"><header class="container"><nav class="relative select-none bg-grey lg:flex lg:items-stretch w-full pt-4"><div class="flex flex-no-shrink items-stretch h-12"><a class="flex-no-grow flex-no-shrink relative p-2 leading-normal text-3xl lg:text-5xl no-underline font-semibold flex items-center" href="/">InvestingSnippets</a><button id="hamburgerMenu" type="button" class="block lg:hidden cursor-pointer ml-auto relative w-12 h-12 p-4"><svg id="hamburgerBtn" class="visible fill-current text-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg><svg id="hamburgerClose" class="hidden fill-current text-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"></path></svg></button></div><div class="lg:flex lg:items-stretch lg:flex-no-shrink lg:flex-grow hidden" id="mobileMenu"><div class="lg:flex lg:items-stretch lg:justify-end ml-auto"><a class="flex-no-grow flex-no-shrink relative py-2 px-4 leading-normal font-semibold text-gray-700 no-underline flex items-center hover:bg-grey-dark" href="/topic/mathematics"><span>Mathematics</span></a><a class="flex-no-grow flex-no-shrink relative py-2 px-4 leading-normal font-semibold text-gray-700 no-underline flex items-center hover:bg-grey-dark" href="/topic/automation"><span>Automation</span></a><a class="flex-no-grow flex-no-shrink relative py-2 px-4 leading-normal font-semibold text-gray-700 no-underline flex items-center hover:bg-grey-dark" href="/topic/investing"><span>Investing</span></a></div></div></nav></header><main class="block lg:flex lg:space-x-2 px-2 lg:p-0 mt-10 mb-10"><div class="w-full lg:w-2/3 px-2"><article><header class="mb-8"><p class="text-sm mb-2"><a class="" href="/">Home</a> &gt; <a class="" href="/topic/investing">Investing</a> &gt; </p><h1 class="mb-2 text-3xl lg:text-4xl leading-none font-display font-semibold">Modern Portfolio Theory - Part 2</h1><p class="text-sm mb-2">June 21, 2021<!-- --> <!-- -->by<!-- --> <!-- -->Chris</p><div class="flex justify-end mt-2 mr-5"><a class="text-gray-600" href="/tag/python"><img class="filter-orange-700 h-4 w-4 m-1 inline-block" alt="python" src="https://www.investingsnippets.com/static/python.svg" data-srcset="https://www.investingsnippets.com/static/python.svg"/>python</a></div><div class="flex justify-end mt-2 mr-5"><a target="_blank" rel="noopener noreferrer" href="https://colab.research.google.com/drive/1UhsvOExkQsHE_wIBzQR9rqwcKUSI_FZr?usp=sharing"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></div></header><div class="mb-4 prose-lg max-w-none markdown-styles_reactMarkDown__3jmlK"><p>Previously in <a href="/post/modern-portfolio-theory">Modern Portfolio Theory - Part 1</a> we located the global minimum variance portfolio (GMV) on the Efficient Frontier. In <a href="/post/inflation-planning-future-cash-flows">Inflation - Planning Forward!</a> we showed how inflation drags down the real return of an investment.</p>
<p>While GMV would pose the minimum (estimated) risk for an investor, it might not be the one that outperforms inflation. In addition to that, government bonds are considered very low risk and yield an annual return which is the profit for the investor. When constructing a portfolio of assets that are riskier, the expectation on return should be higher. A return that surpasses inflation and bond returns should be the goal.</p>
<p>Quoting from <a href="https://www.investopedia.com/terms/r/risk-freerate.asp">Investopedia - Risk-Free Rate Of Return</a></p>
<blockquote>
<p>The risk-free rate of return is the theoretical rate of return of an investment with zero risk. The real risk-free rate can be calculated by subtracting the current inflation rate from the yield of the Treasury bond matching your investment duration.</p>
</blockquote>
<p>Back to the <a href="https://en.wikipedia.org/wiki/Modern_portfolio_theory">wikipedia</a> article on Modern Portfolio Theory we notice some pretty interesting aspects.</p>
<p><div class="w-full mx-auto flex justify-center"><img class="lazyload blur-up" alt="jpg" data-srcset="https://upload.wikimedia.org/wikipedia/commons/e/e1/Markowitz_frontier.jpg"/></div></p>
<ol>
<li>There can be a portfolio which yields the risk-free rate and has ~0 standard deviation. It is with minimal risk. That can be a government bond/bill/note for example.</li>
<li>When we start mixing low risk assets (like bonds) with risky assets (like stocks) the return increases but it cannot cross above a line. That, is presented in the graph above with the <code>Best possible CAL</code> line which is the Efficient Frontier of the portfolios that hold both risky and non-risky assets. It is called Capital Allocation Line (CAL) or Capital Market Line (CML).</li>
<li>There is a point where the line touches the risky asset portfolios Efficient Frontier (<code>Tangency Portfolio</code> or <code>Maximum Sharpe Ratio Portfolio</code>).</li>
</ol>
<blockquote>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>h</mi><mi>a</mi><mi>r</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mo>=</mo><mfrac><mrow><msub><mi>R</mi><mi>p</mi></msub><mo>−</mo><msub><mi>R</mi><mi>f</mi></msub></mrow><msub><mi>σ</mi><mi>p</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">Sharpe Ratio = \frac{R_p - R_f}{\sigma_p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.05764em">S</span><span class="mord mathnormal">ha</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.5337309999999997em;vertical-align:-0.5423199999999999em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9914109999999998em"><span style="top:-2.655em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285716em"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.51308em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285716em"><span style="top:-2.357em;margin-left:-0.00773em;margin-right:0.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em"><span style="top:-2.3487714285714287em;margin-left:-0.00773em;margin-right:0.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29011428571428566em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423199999999999em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> where</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">R_p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span></span></span></span></span> = Portfolio return</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>f</mi></msub></mrow><annotation encoding="application/x-tex">R_f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span></span></span></span></span> = Risk free rate</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">\sigma_p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span></span></span></span></span> = Portfolio standard deviation</li>
</ul>
</blockquote>
<p>The point in the graph that gives us the best possible return for every unit of risk we take is called <code>Maximum Sharpe Ratio Portfolio</code>.</p>
<details><summary>Package Installation</summary>
<p>
</p><pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#a9b7c6">%</span><span class="token" style="color:#a9b7c6">%</span><span>capture
</span><span></span><span class="token" style="color:#a9b7c6">%</span><span>pip install yahoofinancials
</span><span></span><span class="token" style="color:#cc7832">from</span><span> yahoofinancials </span><span class="token" style="color:#cc7832">import</span><span> YahooFinancials
</span><span></span><span class="token" style="color:#cc7832">import</span><span> pandas </span><span class="token" style="color:#cc7832">as</span><span> pd
</span><span></span><span class="token" style="color:#cc7832">import</span><span> matplotlib
</span><span></span><span class="token" style="color:#cc7832">import</span><span> matplotlib</span><span class="token" style="color:#a9b7c6">.</span><span>lines </span><span class="token" style="color:#cc7832">as</span><span> mlines
</span><span></span><span class="token" style="color:#cc7832">import</span><span> matplotlib</span><span class="token" style="color:#a9b7c6">.</span><span>pyplot </span><span class="token" style="color:#cc7832">as</span><span> plt
</span><span></span><span class="token" style="color:#cc7832">import</span><span> dateutil</span><span class="token" style="color:#a9b7c6">.</span><span>parser
</span><span></span><span class="token" style="color:#cc7832">import</span><span> numpy </span><span class="token" style="color:#cc7832">as</span><span> np
</span><span></span><span class="token" style="color:#cc7832">from</span><span> scipy</span><span class="token" style="color:#a9b7c6">.</span><span>optimize </span><span class="token" style="color:#cc7832">import</span><span> minimize</span></code></div></pre>
<p></p>
</details>
<details><summary>Helper Functions</summary>
<p>
</p><pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">retrieve_stock_data</span><span class="token" style="color:#a9b7c6">(</span><span>symbol</span><span class="token" style="color:#a9b7c6">,</span><span> start</span><span class="token" style="color:#a9b7c6">,</span><span> end</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    </span><span class="token triple-quoted-string" style="color:#6a8759">&quot;&quot;&quot;Fetches daily stock prices from Yahoo Finance&quot;&quot;&quot;</span><span>
</span><span>    json </span><span class="token" style="color:#a9b7c6">=</span><span> YahooFinancials</span><span class="token" style="color:#a9b7c6">(</span><span>symbol</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>get_historical_price_data</span><span class="token" style="color:#a9b7c6">(</span><span>start</span><span class="token" style="color:#a9b7c6">,</span><span> end</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&quot;daily&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>    df </span><span class="token" style="color:#a9b7c6">=</span><span> pd</span><span class="token" style="color:#a9b7c6">.</span><span>DataFrame</span><span class="token" style="color:#a9b7c6">(</span><span>columns</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;adjclose&quot;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">for</span><span> row </span><span class="token" style="color:#cc7832">in</span><span> json</span><span class="token" style="color:#a9b7c6">[</span><span>symbol</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;prices&quot;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>        d </span><span class="token" style="color:#a9b7c6">=</span><span> dateutil</span><span class="token" style="color:#a9b7c6">.</span><span>parser</span><span class="token" style="color:#a9b7c6">.</span><span>isoparse</span><span class="token" style="color:#a9b7c6">(</span><span>row</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;formatted_date&quot;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>        df</span><span class="token" style="color:#a9b7c6">.</span><span>loc</span><span class="token" style="color:#a9b7c6">[</span><span>d</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>row</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;adjclose&quot;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">]</span><span>
</span><span>    df</span><span class="token" style="color:#a9b7c6">.</span><span>index</span><span class="token" style="color:#a9b7c6">.</span><span>name </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6a8759">&quot;date&quot;</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> df
</span>
<span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">arithmetic_returns</span><span class="token" style="color:#a9b7c6">(</span><span>S</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    </span><span class="token triple-quoted-string" style="color:#6a8759">&quot;&quot;&quot;Returns the arithmetic returns. (price_today - price_yesterday)/price_yesterday&quot;&quot;&quot;</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> S</span><span class="token" style="color:#a9b7c6">.</span><span>pct_change</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>dropna</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">annualize_rets</span><span class="token" style="color:#a9b7c6">(</span><span>r</span><span class="token" style="color:#a9b7c6">,</span><span> periods_per_year</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    compounded_growth </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">+</span><span>r</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>prod</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>    n_periods </span><span class="token" style="color:#a9b7c6">=</span><span> r</span><span class="token" style="color:#a9b7c6">.</span><span>shape</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">]</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> compounded_growth</span><span class="token" style="color:#a9b7c6">**</span><span class="token" style="color:#a9b7c6">(</span><span>periods_per_year</span><span class="token" style="color:#a9b7c6">/</span><span>n_periods</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">1</span><span>
</span>
<span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">portfolio_return</span><span class="token" style="color:#a9b7c6">(</span><span>weights</span><span class="token" style="color:#a9b7c6">,</span><span> returns</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> weights</span><span class="token" style="color:#a9b7c6">.</span><span>T @ returns
</span>
<span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">portfolio_volatility</span><span class="token" style="color:#a9b7c6">(</span><span>weights</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>weights</span><span class="token" style="color:#a9b7c6">.</span><span>T @ covariance_matrix @ weights</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">**</span><span class="token" style="color:#6897bb">0.5</span><span>
</span>
<span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">generate_returns_dataframe</span><span class="token" style="color:#a9b7c6">(</span><span>symbols_list</span><span class="token" style="color:#a9b7c6">,</span><span> d_from</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;2020-01-01&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> d_to</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;2021-01-01&quot;</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    </span><span class="token triple-quoted-string" style="color:#6a8759">&quot;&quot;&quot;Generates a DataFrame with daily returns for a list of Symbols.&quot;&quot;&quot;</span><span>
</span><span>    returns </span><span class="token" style="color:#a9b7c6">=</span><span> pd</span><span class="token" style="color:#a9b7c6">.</span><span>DataFrame</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">for</span><span> symbol </span><span class="token" style="color:#cc7832">in</span><span> symbols_list</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>        stock_prices </span><span class="token" style="color:#a9b7c6">=</span><span> retrieve_stock_data</span><span class="token" style="color:#a9b7c6">(</span><span>symbol</span><span class="token" style="color:#a9b7c6">,</span><span> d_from</span><span class="token" style="color:#a9b7c6">,</span><span> d_to</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>        rets </span><span class="token" style="color:#a9b7c6">=</span><span> arithmetic_returns</span><span class="token" style="color:#a9b7c6">(</span><span>stock_prices</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>dropna</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>        rets</span><span class="token" style="color:#a9b7c6">.</span><span>columns </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>symbol</span><span class="token" style="color:#a9b7c6">]</span><span>
</span>
<span>        </span><span class="token" style="color:#cc7832">if</span><span> returns</span><span class="token" style="color:#a9b7c6">.</span><span>empty</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>            returns </span><span class="token" style="color:#a9b7c6">=</span><span> rets
</span><span>        </span><span class="token" style="color:#cc7832">else</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>            returns </span><span class="token" style="color:#a9b7c6">=</span><span> returns</span><span class="token" style="color:#a9b7c6">.</span><span>merge</span><span class="token" style="color:#a9b7c6">(</span><span>rets</span><span class="token" style="color:#a9b7c6">,</span><span> left_index</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#cc7832">True</span><span class="token" style="color:#a9b7c6">,</span><span> right_index</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#cc7832">True</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> returns
</span>
<span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">global_minimum_variance</span><span class="token" style="color:#a9b7c6">(</span><span>returns</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>  </span><span class="token triple-quoted-string" style="color:#6a8759">&quot;&quot;&quot;Returns the weights of the GMV portfolio&quot;&quot;&quot;</span><span>
</span><span>  n </span><span class="token" style="color:#a9b7c6">=</span><span> returns</span><span class="token" style="color:#a9b7c6">.</span><span>shape</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">]</span><span>
</span><span>  weights_sum_to_1 </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>      </span><span class="token" style="color:#6a8759">&#x27;type&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&#x27;eq&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>      </span><span class="token" style="color:#6a8759">&#x27;fun&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#cc7832">lambda</span><span> weights</span><span class="token" style="color:#a9b7c6">:</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#e8bf6a">sum</span><span class="token" style="color:#a9b7c6">(</span><span>weights</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">-</span><span> </span><span class="token" style="color:#6897bb">1</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>  result </span><span class="token" style="color:#a9b7c6">=</span><span> minimize</span><span class="token" style="color:#a9b7c6">(</span><span>portfolio_volatility</span><span class="token" style="color:#a9b7c6">,</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>repeat</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">/</span><span>n</span><span class="token" style="color:#a9b7c6">,</span><span> n</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span> args</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span>covariance_matrix</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>                    method</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;SLSQP&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> options</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#6a8759">&#x27;disp&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#cc7832">False</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>                    constraints</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span>weights_sum_to_1</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span> bounds</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">0.0</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6897bb">1.0</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">*</span><span>n</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">return</span><span> result</span><span class="token" style="color:#a9b7c6">.</span><span>x
</span>
<span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">efficient_frontier_dataframe</span><span class="token" style="color:#a9b7c6">(</span><span>annualized_returns</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span> 
</span><span>  </span><span class="token" style="color:#808080"># first we construct 10 pairs of weights like [(0.1,0.9), (0.2,0.8) ...]</span><span>
</span><span>  weights </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>np</span><span class="token" style="color:#a9b7c6">.</span><span>array</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">[</span><span>w</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">-</span><span>w</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#cc7832">for</span><span> w </span><span class="token" style="color:#cc7832">in</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>linspace</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6897bb">10</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">]</span><span>
</span>
<span>  </span><span class="token" style="color:#808080"># then we calculate the return of the portfolio for each pair of weights</span><span>
</span><span>  portfolio_returns </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>portfolio_return</span><span class="token" style="color:#a9b7c6">(</span><span>w</span><span class="token" style="color:#a9b7c6">,</span><span> annualized_returns</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#cc7832">for</span><span> w </span><span class="token" style="color:#cc7832">in</span><span> weights</span><span class="token" style="color:#a9b7c6">]</span><span>
</span>
<span>  </span><span class="token" style="color:#808080"># and the volatility of the portfolio for each pair of weights</span><span>
</span><span>  vols </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>portfolio_volatility</span><span class="token" style="color:#a9b7c6">(</span><span>w</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#cc7832">for</span><span> w </span><span class="token" style="color:#cc7832">in</span><span> weights</span><span class="token" style="color:#a9b7c6">]</span><span>
</span>
<span>  </span><span class="token" style="color:#cc7832">return</span><span> pd</span><span class="token" style="color:#a9b7c6">.</span><span>DataFrame</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>      </span><span class="token" style="color:#6a8759">&quot;Return&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> portfolio_returns</span><span class="token" style="color:#a9b7c6">,</span><span> 
</span><span>      </span><span class="token" style="color:#6a8759">&quot;Volatility&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> vols</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>      </span><span class="token" style="color:#6a8759">&quot;weights&quot;</span><span class="token" style="color:#a9b7c6">:</span><span> weights
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">print_weights_on_graph</span><span class="token" style="color:#a9b7c6">(</span><span>ax</span><span class="token" style="color:#a9b7c6">,</span><span> x</span><span class="token" style="color:#a9b7c6">,</span><span> y</span><span class="token" style="color:#a9b7c6">,</span><span> val</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>  </span><span class="token triple-quoted-string" style="color:#6a8759">&quot;&quot;&quot;Adds the weight on the efficient frontier&quot;&quot;&quot;</span><span>
</span><span>  a </span><span class="token" style="color:#a9b7c6">=</span><span> pd</span><span class="token" style="color:#a9b7c6">.</span><span>concat</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#6a8759">&#x27;x&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span> x</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&#x27;y&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span> y</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&#x27;val&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span> val</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span> axis</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">for</span><span> i</span><span class="token" style="color:#a9b7c6">,</span><span> point </span><span class="token" style="color:#cc7832">in</span><span> a</span><span class="token" style="color:#a9b7c6">.</span><span>iterrows</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    prettified_p </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token string-interpolation token" style="color:#6a8759">f&quot;(</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">{</span><span class="token string-interpolation token interpolation token" style="color:#e8bf6a">round</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">(</span><span class="token string-interpolation token interpolation">point</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">[</span><span class="token string-interpolation token interpolation token" style="color:#6a8759">&#x27;val&#x27;</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">]</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">[</span><span class="token string-interpolation token interpolation token" style="color:#6897bb">0</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">]</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">,</span><span class="token string-interpolation token interpolation"> </span><span class="token string-interpolation token interpolation token" style="color:#6897bb">2</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">)</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">}</span><span class="token string-interpolation token" style="color:#6a8759">,</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">{</span><span class="token string-interpolation token interpolation token" style="color:#e8bf6a">round</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">(</span><span class="token string-interpolation token interpolation">point</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">[</span><span class="token string-interpolation token interpolation token" style="color:#6a8759">&#x27;val&#x27;</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">]</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">[</span><span class="token string-interpolation token interpolation token" style="color:#6897bb">1</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">]</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">,</span><span class="token string-interpolation token interpolation"> </span><span class="token string-interpolation token interpolation token" style="color:#6897bb">2</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">)</span><span class="token string-interpolation token interpolation token" style="color:#a9b7c6">}</span><span class="token string-interpolation token" style="color:#6a8759">)&quot;</span><span>
</span><span>    ax</span><span class="token" style="color:#a9b7c6">.</span><span>text</span><span class="token" style="color:#a9b7c6">(</span><span>point</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;x&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span> point</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;y&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span> prettified_p</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">plot_custom_legend</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>  </span><span class="token triple-quoted-string" style="color:#6a8759">&quot;&quot;&quot;Adds a custom legend for the different points on the graph&quot;&quot;&quot;</span><span>
</span><span>  blue_star </span><span class="token" style="color:#a9b7c6">=</span><span> mlines</span><span class="token" style="color:#a9b7c6">.</span><span>Line2D</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span> color</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;blue&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> marker</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;*&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> linestyle</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;None&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>                            markersize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">10</span><span class="token" style="color:#a9b7c6">,</span><span> label</span><span class="token" style="color:#a9b7c6">=</span><span class="token string-interpolation token" style="color:#6a8759">f&quot;MSR&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  red_square </span><span class="token" style="color:#a9b7c6">=</span><span> mlines</span><span class="token" style="color:#a9b7c6">.</span><span>Line2D</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span> color</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;red&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> marker</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;s&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> linestyle</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;None&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>                            markersize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">10</span><span class="token" style="color:#a9b7c6">,</span><span> label</span><span class="token" style="color:#a9b7c6">=</span><span class="token string-interpolation token" style="color:#6a8759">f&quot;GMV&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  purple_triangle </span><span class="token" style="color:#a9b7c6">=</span><span> mlines</span><span class="token" style="color:#a9b7c6">.</span><span>Line2D</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span> color</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;green&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> marker</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;^&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> linestyle</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;None&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>                            markersize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">10</span><span class="token" style="color:#a9b7c6">,</span><span> label</span><span class="token" style="color:#a9b7c6">=</span><span class="token string-interpolation token" style="color:#6a8759">f&quot;Mix&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span>  plt</span><span class="token" style="color:#a9b7c6">.</span><span>legend</span><span class="token" style="color:#a9b7c6">(</span><span>handles</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">[</span><span>blue_star</span><span class="token" style="color:#a9b7c6">,</span><span> red_square</span><span class="token" style="color:#a9b7c6">,</span><span> purple_triangle</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<p></p>
</details>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>STOCK_SYMBOLS </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;MSFT&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&#x27;APT&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span>
</span><span>returns </span><span class="token" style="color:#a9b7c6">=</span><span> generate_returns_dataframe</span><span class="token" style="color:#a9b7c6">(</span><span>STOCK_SYMBOLS</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>covariance_matrix </span><span class="token" style="color:#a9b7c6">=</span><span> returns</span><span class="token" style="color:#a9b7c6">.</span><span>cov</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>annualized_returns </span><span class="token" style="color:#a9b7c6">=</span><span> annualize_rets</span><span class="token" style="color:#a9b7c6">(</span><span>returns</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6897bb">252</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>gmv </span><span class="token" style="color:#a9b7c6">=</span><span> global_minimum_variance</span><span class="token" style="color:#a9b7c6">(</span><span>annualized_returns</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<h2>Capital Allocation Line &amp; Maximum Sharpe Ratio Portfolio (MSR)</h2>
<p>Similar to what we did with the GMV portfolio (in <a href="/post/modern-portfolio-theory">Modern Portfolio Theory - Part 1</a>), we will do with finding the MSR Portfolio. Instead of trying to minimize the volatility, we will maximize the sharpe ratio. To achieve that, we will use the exact same quadratic programming approach and the <code>minimize</code> function from <code>scipy</code>.</p>
<p>However, to turn maximization into minimization, we will do a simple trick! we will minimize the negative value of the sharpe ratio :)</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">maximum_sharpe_ratio</span><span class="token" style="color:#a9b7c6">(</span><span>returns</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">,</span><span> risk_free_rate</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>  </span><span class="token triple-quoted-string" style="color:#6a8759">&quot;&quot;&quot;Returns the weights of the MSR portfolio&quot;&quot;&quot;</span><span>
</span><span>  n </span><span class="token" style="color:#a9b7c6">=</span><span> returns</span><span class="token" style="color:#a9b7c6">.</span><span>shape</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">]</span><span>
</span><span>  weights_sum_to_1 </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span>
</span><span>      </span><span class="token" style="color:#6a8759">&#x27;type&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#6a8759">&#x27;eq&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>      </span><span class="token" style="color:#6a8759">&#x27;fun&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#cc7832">lambda</span><span> weights</span><span class="token" style="color:#a9b7c6">:</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#e8bf6a">sum</span><span class="token" style="color:#a9b7c6">(</span><span>weights</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">-</span><span> </span><span class="token" style="color:#6897bb">1</span><span>
</span><span>  </span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span>  </span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">negative_sharpe_ratio</span><span class="token" style="color:#a9b7c6">(</span><span>weights</span><span class="token" style="color:#a9b7c6">,</span><span> returns</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">,</span><span> risk_free_rate</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    p_rets </span><span class="token" style="color:#a9b7c6">=</span><span> portfolio_return</span><span class="token" style="color:#a9b7c6">(</span><span>weights</span><span class="token" style="color:#a9b7c6">,</span><span> returns</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>    p_vol </span><span class="token" style="color:#a9b7c6">=</span><span> portfolio_volatility</span><span class="token" style="color:#a9b7c6">(</span><span>weights</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> </span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#a9b7c6">(</span><span>p_rets </span><span class="token" style="color:#a9b7c6">-</span><span> risk_free_rate</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">/</span><span>p_vol
</span>
<span>  result </span><span class="token" style="color:#a9b7c6">=</span><span> minimize</span><span class="token" style="color:#a9b7c6">(</span><span>negative_sharpe_ratio</span><span class="token" style="color:#a9b7c6">,</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>repeat</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">/</span><span>n</span><span class="token" style="color:#a9b7c6">,</span><span> n</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>                    args</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span>returns</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">,</span><span> risk_free_rate</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>                    method</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;SLSQP&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> options</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#6a8759">&#x27;disp&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span> </span><span class="token" style="color:#cc7832">False</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>                    constraints</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span>weights_sum_to_1</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span> bounds</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">0.0</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6897bb">1.0</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">*</span><span>n</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">return</span><span> result</span><span class="token" style="color:#a9b7c6">.</span><span>x</span></code></div></pre>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>risk_free_rate </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6897bb">0.03</span><span>
</span><span>msr </span><span class="token" style="color:#a9b7c6">=</span><span> maximum_sharpe_ratio</span><span class="token" style="color:#a9b7c6">(</span><span>annualized_returns</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">,</span><span> risk_free_rate</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>msr
</code></div></pre>
<p>array([0.75444897, 0.24555103])</p>
<h2>Plotting GMV, MSR, CAL &amp; Mixed portfolio</h2>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080"># get the efficient frontier as dataframe and plot it</span><span>
</span><span>ef </span><span class="token" style="color:#a9b7c6">=</span><span> efficient_frontier_dataframe</span><span class="token" style="color:#a9b7c6">(</span><span>annualized_returns</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax </span><span class="token" style="color:#a9b7c6">=</span><span> ef</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>x</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;Volatility&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> y</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;Return&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> style</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;.-&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> figsize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">14</span><span class="token" style="color:#a9b7c6">,</span><span class="token" style="color:#6897bb">7</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span>
</span><span>             title</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;2 Asset Portfolio Risk/Return&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> legend</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#cc7832">False</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>set_xlim</span><span class="token" style="color:#a9b7c6">(</span><span>left</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>plt</span><span class="token" style="color:#a9b7c6">.</span><span>ylabel</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;Return&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span></span><span class="token" style="color:#808080"># show the different weights on the efficient frontier</span><span>
</span><span>print_weights_on_graph</span><span class="token" style="color:#a9b7c6">(</span><span>ax</span><span class="token" style="color:#a9b7c6">,</span><span> ef</span><span class="token" style="color:#a9b7c6">.</span><span>Volatility</span><span class="token" style="color:#a9b7c6">,</span><span> ef</span><span class="token" style="color:#a9b7c6">.</span><span>Return</span><span class="token" style="color:#a9b7c6">,</span><span> ef</span><span class="token" style="color:#a9b7c6">.</span><span>weights</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span></span><span class="token" style="color:#808080"># find the MSR point and add a marker</span><span>
</span><span>rets_msr </span><span class="token" style="color:#a9b7c6">=</span><span> portfolio_return</span><span class="token" style="color:#a9b7c6">(</span><span>msr</span><span class="token" style="color:#a9b7c6">,</span><span> annualized_returns</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>vol_msr </span><span class="token" style="color:#a9b7c6">=</span><span> portfolio_volatility</span><span class="token" style="color:#a9b7c6">(</span><span>msr</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>vol_msr</span><span class="token" style="color:#a9b7c6">,</span><span> rets_msr</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&#x27;b*&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> markersize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">10</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span></span><span class="token" style="color:#808080"># construct and plot the Capital Allocation Line</span><span>
</span><span>cal_x </span><span class="token" style="color:#a9b7c6">=</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>arange</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">,</span><span> vol_msr</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>vol_msr</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#6897bb">100</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>cal_y </span><span class="token" style="color:#a9b7c6">=</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>arange</span><span class="token" style="color:#a9b7c6">(</span><span>risk_free_rate</span><span class="token" style="color:#a9b7c6">,</span><span> rets_msr</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>rets_msr</span><span class="token" style="color:#a9b7c6">-</span><span>risk_free_rate</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#6897bb">100</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>cal_x</span><span class="token" style="color:#a9b7c6">,</span><span> cal_y</span><span class="token" style="color:#a9b7c6">,</span><span> color</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;green&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> linestyle</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;dashed&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span></span><span class="token" style="color:#808080"># find the GMV point and add a marker</span><span>
</span><span>rets_gmv </span><span class="token" style="color:#a9b7c6">=</span><span> portfolio_return</span><span class="token" style="color:#a9b7c6">(</span><span>gmv</span><span class="token" style="color:#a9b7c6">,</span><span> annualized_returns</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>vol_gmv </span><span class="token" style="color:#a9b7c6">=</span><span> portfolio_volatility</span><span class="token" style="color:#a9b7c6">(</span><span>gmv</span><span class="token" style="color:#a9b7c6">,</span><span> covariance_matrix</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>vol_gmv</span><span class="token" style="color:#a9b7c6">,</span><span> rets_gmv</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&#x27;rs&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> markersize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">10</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span></span><span class="token" style="color:#808080"># locate the Mixed portfolio on CAL that has less risk than the GMV</span><span>
</span><span>idx </span><span class="token" style="color:#a9b7c6">=</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>argwhere</span><span class="token" style="color:#a9b7c6">(</span><span>np</span><span class="token" style="color:#a9b7c6">.</span><span>diff</span><span class="token" style="color:#a9b7c6">(</span><span>np</span><span class="token" style="color:#a9b7c6">.</span><span>sign</span><span class="token" style="color:#a9b7c6">(</span><span>rets_gmv </span><span class="token" style="color:#a9b7c6">-</span><span> cal_y</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>flatten</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>cal_x</span><span class="token" style="color:#a9b7c6">[</span><span>idx</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span> cal_y</span><span class="token" style="color:#a9b7c6">[</span><span>idx</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&#x27;g^&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> markersize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">10</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span></span><span class="token" style="color:#808080"># Add a custom legend for the markers</span><span>
</span><span>plot_custom_legend</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>plt</span><span class="token" style="color:#a9b7c6">.</span><span>show</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<p><div class="w-full mx-auto flex justify-center"><img class="lazyload blur-up" alt="png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAAAklEQVR4AewaftIAAACbSURBVG3BMQ6CMBgG0K+0oT8CLsYF0ImNK0jiRVw8k2ciTk4mEBhIvINga1uU6GLie+zWdodVmhyllJj1fe9rrb0oilSSpNOgFKwxV7HeZFsi2uMrz3M89BMz6xyW4QLGGC7GceREBOsmKK3BGANJHwy/BBE56yzG4Y4gCME5xz+iOleXcleemqb18BbH8VTXtciyzOCDFUXRvQDZxzoOjVTxewAAAABJRU5ErkJggg==" data-srcset="/_next/static/images/modern-portfolio-theory-gmv-msr-mixed-8-0-c4426c9fc3eaa6c410f6c8732703323a.png"/></div></p>
<h2>MSR vs. GMV vs. Mixed Portfolio</h2>
<p>From the graph above we can pinpoint 3 interesting portfolios:</p>
<ul>
<li>The GMV portfolio which depends solely on the covariance matrix.</li>
<li>The MSR portfolio which depends both on the covariance matrix and the expected returns.</li>
<li>The Mixed Portfolio which can yield same return as the GMV but with less risk.</li>
</ul>
<p>So far, we took advantage of the historical data and constructed some portfolios. However, <strong>historical returns are no guarantee of future returns</strong>. Estimating returns is very difficult and requires experience, deep knowledge of the respective assets, continuous monitoring of the market and much more.</p>
<p>So, which portfolio is best to hold? The answer to that cannot be given with certainty!</p>
<p>GMV does not take into account returns (or estimated expected returns) and thus makes it easier to calculate, but at the same time, constructing the covariance matrix for a long list of assets falls under the well known <a href="https://en.wikipedia.org/wiki/Curse_of_dimensionality">Curse of Dimensionality</a> problem.</p>
<p>MSR poses the difficulty of estimating expected returns and thus includes increased risk.</p>
<p>The mixed portfolio combines non risky assets with risky assets while lowering the risk. However, the covariance matrix is yet there to calculate.</p>
<p>All in all, each portfolio includes risk, which we call <strong>model risk</strong>. There are several ways to tackle this model risk and I will try to address them in future articles.</p>
<p>Until then, enjoy!</p></div><hr class="mt-4"/><footer></footer></article><nav class="flex flex-wrap justify-between mb-10"><a class="text-lg font-bold" href="/post/inflation-looking-back">←<!-- --> <!-- -->Inflation - Looking Back!</a><div></div></nav><div shortname="investingsnippets" config="[object Object]" id="disqus_thread"></div></div><div class="w-full lg:w-1/3 px-2"><div class="border border-dotted mt-4 visible lg:invisible lg:mt-0"></div><div class="my-4 lg:mt-0"><content><h5 class="font-semibold text-lg uppercase text-gray-700">About<!-- --> <!-- -->InvestingSnippets</h5><div class="flex-auto flex-no-wrap flex-shrink-0 text-center pt-5"><a href="https://twitter.com/investingsnipts" class="inline-block hover:text-blue-700 no-label px-2" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="25px"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://github.com/investingsnippets" class="inline-block hover:text-blue-700 no-label px-2" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" width="25px"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://www.linkedin.com/in/investingsnippets/" class="inline-block hover:text-blue-700 no-label px-2" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="25px"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></div><div class="flex items-center my-5"><p class="text-base leading-7">Driven by my passion to always dive deep in new knowledge, I started this blog as an attempt to give my own simplified view on how I apply my Software Engineering skills and background in Mathematics to Investing! NO financial advice or consulting is provided! I use python and try to automate as much as possible.</p></div><div class="flex"><a href="https://twitter.com/investingsnipts" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false"> </a></div></content></div><div class="border border-dotted"></div><div class="my-2 lg:my-4"><content><h5 class="font-semibold text-lg uppercase text-gray-700 mb-2"> Topics </h5><ul><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/topic/investing"><span>Investing</span><span class="text-gray-500 ml-auto">10<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/topic/mathematics"><span>Mathematics</span><span class="text-gray-500 ml-auto">4<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/topic/automation"><span>Automation</span><span class="text-gray-500 ml-auto">2<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li></ul></content></div><div class="border border-dotted"></div><div class="my-2 lg:my-4"><content><h5 class="font-semibold text-lg uppercase text-gray-700 mb-2"> Popular Tags </h5><ul><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/tag/python"><div class="filter-orange-700 h-4 w-4 mr-3 inline-block"><img class="lazyload blur-up" alt="python" data-srcset="https://www.investingsnippets.com/static/python.svg"/></div><span>python</span><span class="text-gray-500 ml-auto">12<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/tag/statistics"><div class="filter-orange-700 h-4 w-4 mr-3 inline-block"><img class="lazyload blur-up" alt="statistics" data-srcset="https://www.investingsnippets.com/static/statistics.svg"/></div><span>statistics</span><span class="text-gray-500 ml-auto">4<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/tag/cryptos"><div class="filter-orange-700 h-4 w-4 mr-3 inline-block"><img class="lazyload blur-up" alt="cryptos" data-srcset="https://www.investingsnippets.com/static/bitcoin.svg"/></div><span>cryptos</span><span class="text-gray-500 ml-auto">1<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li></ul></content></div><div class="border border-dotted"></div><div class="my-2 lg:my-4"><content><h5 class="font-semibold text-lg uppercase text-gray-700 mb-2"> Subscribe </h5><p class="text-gray-600">Receive the next blog article directly to your email!</p><form action="https://tinyletter.com/investingsnippets" method="post" target="popupwindow"><input type="email" name="email" id="tlemail" title="Email" required="" placeholder="your email address" class="text-gray-700 bg-gray-100 rounded-t hover:outline-none p-2 w-full mt-4 border outline-none"/><input type="hidden" value="1" name="embed"/><button type="submit" class="px-4 py-2 bg-orange-700 text-gray-200 rounded-b w-full capitalize tracking-wide">Subscribe</button></form><p class="text-gray-600 pt-2 text-xs text-center">or, follow the<!-- --> <a href="/feed.xml" class="inline-block hover:text-blue-700 no-label px-2" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" class="svg-inline--fa fa-rss fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="10px"><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg></a></p></content></div><div class="border border-dotted invisible lg:visible"></div></div></main><footer class="border-t py-12 px-2"><div class="flex pb-4"><div class="flex-auto"><h6><a class="font-semibold text-gray-700 mb-4 no-underline" href="/">Home</a></h6></div><div class="flex-auto"><h6><a class="font-semibold text-gray-700 mb-4 no-underline" href="/terms/general-terms">Terms</a></h6></div></div><div class="text-sm my-2 leading-4 text-gray-600">The content, opinions and conclusions on this website are NOT to be construed as financial advice. I always recommend contacting a licensed independent financial advisor. InvestingSnippets assumes no responsibility for any losses, costs or other consequences that may arise from actions or measures taken based on the content of the website. Investing in financial instruments, securities and mutual funds always involves a risk. The instruments can both increase and decrease in value, also as a result of changes in the exchange rate. It is not certain that you will get back the invested capital. Historical returns are no guarantee of future returns.</div><div class="my-2 text-sm text-gray-600">Copyright ©<!-- --> <!-- -->2021<!-- -->,<!-- --> <!-- -->InvestingSnippets</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"frontmatter":{"title":"Modern Portfolio Theory - Part 2","description":"Global Minimum Variance (GMV), Maximum Sharpe Ratio (MSR), Capital Allocation Line (Cal) and the mixed portfolio.","date":"June 21, 2021","topic":{"id":"investing","name":"Investing","image":"investing.png","description":"The piggy bank digests a good amount of the savings! There is only one way to get away ... investing. BUT, there is a hidden enemy, Speculation!","color":"bg-green-300"},"tags":[{"id":"python","name":"python","image":"python-header.png","description":"Python is very handy in investing","color":"bg-green-300","icon":"python.svg"}],"author":{"id":"chris","name":"Chris","image":"https://s.gravatar.com/avatar/db809ecfa64d56da4bd9704c8393005a?s=80","description":"Software Engineer, passionate about ..."},"img":"/static/nobel-price.jpg","colab":"https://colab.research.google.com/drive/1UhsvOExkQsHE_wIBzQR9rqwcKUSI_FZr?usp=sharing"},"post":{"content":"\nPreviously in [Modern Portfolio Theory - Part 1](/post/modern-portfolio-theory) we located the global minimum variance portfolio (GMV) on the Efficient Frontier. In [Inflation - Planning Forward!](/post/inflation-planning-future-cash-flows) we showed how inflation drags down the real return of an investment. \n\nWhile GMV would pose the minimum (estimated) risk for an investor, it might not be the one that outperforms inflation. In addition to that, government bonds are considered very low risk and yield an annual return which is the profit for the investor. When constructing a portfolio of assets that are riskier, the expectation on return should be higher. A return that surpasses inflation and bond returns should be the goal.\n\nQuoting from [Investopedia - Risk-Free Rate Of Return](https://www.investopedia.com/terms/r/risk-freerate.asp)\n\n\u003e The risk-free rate of return is the theoretical rate of return of an investment with zero risk. The real risk-free rate can be calculated by subtracting the current inflation rate from the yield of the Treasury bond matching your investment duration.\n\nBack to the [wikipedia](https://en.wikipedia.org/wiki/Modern_portfolio_theory) article on Modern Portfolio Theory we notice some pretty interesting aspects. \n\n![jpg](https://upload.wikimedia.org/wikipedia/commons/e/e1/Markowitz_frontier.jpg)\n\n1. There can be a portfolio which yields the risk-free rate and has ~0 standard deviation. It is with minimal risk. That can be a government bond/bill/note for example.\n2. When we start mixing low risk assets (like bonds) with risky assets (like stocks) the return increases but it cannot cross above a line. That, is presented in the graph above with the `Best possible CAL` line which is the Efficient Frontier of the portfolios that hold both risky and non-risky assets. It is called Capital Allocation Line (CAL) or Capital Market Line (CML).\n3. There is a point where the line touches the risky asset portfolios Efficient Frontier (`Tangency Portfolio` or `Maximum Sharpe Ratio Portfolio`).\n\n\u003e $Sharpe Ratio = \\frac{R_p - R_f}{\\sigma_p}$ where \n\u003e * $R_p$ = Portfolio return\n\u003e * $R_f$ = Risk free rate\n\u003e * $\\sigma_p$ = Portfolio standard deviation\n\nThe point in the graph that gives us the best possible return for every unit of risk we take is called `Maximum Sharpe Ratio Portfolio`.\n\n\n\u003cdetails\u003e\u003csummary\u003ePackage Installation\u003c/summary\u003e\n\u003cp\u003e\n\n```python\n%%capture\n%pip install yahoofinancials\nfrom yahoofinancials import YahooFinancials\nimport pandas as pd\nimport matplotlib\nimport matplotlib.lines as mlines\nimport matplotlib.pyplot as plt\nimport dateutil.parser\nimport numpy as np\nfrom scipy.optimize import minimize\n```\n\n\u003c/p\u003e\n\u003c/details\u003e\n\n\u003cdetails\u003e\u003csummary\u003eHelper Functions\u003c/summary\u003e\n\u003cp\u003e\n\n```python\ndef retrieve_stock_data(symbol, start, end):\n    \"\"\"Fetches daily stock prices from Yahoo Finance\"\"\"\n    json = YahooFinancials(symbol).get_historical_price_data(start, end, \"daily\")\n    df = pd.DataFrame(columns=[\"adjclose\"])\n    for row in json[symbol][\"prices\"]:\n        d = dateutil.parser.isoparse(row[\"formatted_date\"])\n        df.loc[d] = [row[\"adjclose\"]]\n    df.index.name = \"date\"\n    return df\n\ndef arithmetic_returns(S):\n    \"\"\"Returns the arithmetic returns. (price_today - price_yesterday)/price_yesterday\"\"\"\n    return S.pct_change().dropna()\n\ndef annualize_rets(r, periods_per_year):\n    compounded_growth = (1+r).prod()\n    n_periods = r.shape[0]\n    return compounded_growth**(periods_per_year/n_periods)-1\n\ndef portfolio_return(weights, returns):\n    return weights.T @ returns\n\ndef portfolio_volatility(weights, covariance_matrix):\n    return (weights.T @ covariance_matrix @ weights)**0.5\n\ndef generate_returns_dataframe(symbols_list, d_from=\"2020-01-01\", d_to=\"2021-01-01\"):\n    \"\"\"Generates a DataFrame with daily returns for a list of Symbols.\"\"\"\n    returns = pd.DataFrame()\n    for symbol in symbols_list:\n        stock_prices = retrieve_stock_data(symbol, d_from, d_to)\n        rets = arithmetic_returns(stock_prices).dropna()\n        rets.columns = [symbol]\n\n        if returns.empty:\n            returns = rets\n        else:\n            returns = returns.merge(rets, left_index=True, right_index=True)\n    return returns\n\ndef global_minimum_variance(returns, covariance_matrix):\n  \"\"\"Returns the weights of the GMV portfolio\"\"\"\n  n = returns.shape[0]\n  weights_sum_to_1 = {\n      'type': 'eq',\n      'fun': lambda weights: np.sum(weights) - 1\n  }\n  result = minimize(portfolio_volatility, np.repeat(1/n, n), args=(covariance_matrix, ),\n                    method=\"SLSQP\", options={'disp': False},\n                    constraints=(weights_sum_to_1), bounds=((0.0, 1.0),)*n)\n  return result.x\n\ndef efficient_frontier_dataframe(annualized_returns, covariance_matrix): \n  # first we construct 10 pairs of weights like [(0.1,0.9), (0.2,0.8) ...]\n  weights = [np.array([w, 1-w]) for w in np.linspace(0, 1, 10)]\n\n  # then we calculate the return of the portfolio for each pair of weights\n  portfolio_returns = [portfolio_return(w, annualized_returns) for w in weights]\n\n  # and the volatility of the portfolio for each pair of weights\n  vols = [portfolio_volatility(w, covariance_matrix) for w in weights]\n\n  return pd.DataFrame({\n      \"Return\": portfolio_returns, \n      \"Volatility\": vols,\n      \"weights\": weights\n  })\n\ndef print_weights_on_graph(ax, x, y, val):\n  \"\"\"Adds the weight on the efficient frontier\"\"\"\n  a = pd.concat({'x': x, 'y': y, 'val': val}, axis=1)\n  for i, point in a.iterrows():\n    prettified_p = f\"({round(point['val'][0], 2)},{round(point['val'][1], 2)})\"\n    ax.text(point['x'], point['y'], prettified_p)\n\ndef plot_custom_legend():\n  \"\"\"Adds a custom legend for the different points on the graph\"\"\"\n  blue_star = mlines.Line2D([], [], color='blue', marker='*', linestyle='None',\n                            markersize=10, label=f\"MSR\")\n  red_square = mlines.Line2D([], [], color='red', marker='s', linestyle='None',\n                            markersize=10, label=f\"GMV\")\n  purple_triangle = mlines.Line2D([], [], color='green', marker='^', linestyle='None',\n                            markersize=10, label=f\"Mix\")\n\n  plt.legend(handles=[blue_star, red_square, purple_triangle])\n```\n\n\u003c/p\u003e\n\u003c/details\u003e\n\n```python\nSTOCK_SYMBOLS = ['MSFT', 'APT']\nreturns = generate_returns_dataframe(STOCK_SYMBOLS)\ncovariance_matrix = returns.cov()\nannualized_returns = annualize_rets(returns, 252)\ngmv = global_minimum_variance(annualized_returns, covariance_matrix)\n```\n\n## Capital Allocation Line \u0026 Maximum Sharpe Ratio Portfolio (MSR)\n\nSimilar to what we did with the GMV portfolio (in [Modern Portfolio Theory - Part 1](/post/modern-portfolio-theory)), we will do with finding the MSR Portfolio. Instead of trying to minimize the volatility, we will maximize the sharpe ratio. To achieve that, we will use the exact same quadratic programming approach and the `minimize` function from `scipy`.\n\nHowever, to turn maximization into minimization, we will do a simple trick! we will minimize the negative value of the sharpe ratio :) \n\n\n```python\ndef maximum_sharpe_ratio(returns, covariance_matrix, risk_free_rate):\n  \"\"\"Returns the weights of the MSR portfolio\"\"\"\n  n = returns.shape[0]\n  weights_sum_to_1 = {\n      'type': 'eq',\n      'fun': lambda weights: np.sum(weights) - 1\n  }\n\n  def negative_sharpe_ratio(weights, returns, covariance_matrix, risk_free_rate):\n    p_rets = portfolio_return(weights, returns)\n    p_vol = portfolio_volatility(weights, covariance_matrix)\n    return -(p_rets - risk_free_rate)/p_vol\n\n  result = minimize(negative_sharpe_ratio, np.repeat(1/n, n),\n                    args=(returns, covariance_matrix, risk_free_rate),\n                    method=\"SLSQP\", options={'disp': False},\n                    constraints=(weights_sum_to_1), bounds=((0.0, 1.0),)*n)\n  return result.x\n```\n\n\n```python\nrisk_free_rate = 0.03\nmsr = maximum_sharpe_ratio(annualized_returns, covariance_matrix, risk_free_rate)\nmsr\n```\n  array([0.75444897, 0.24555103])\n\n## Plotting GMV, MSR, CAL \u0026 Mixed portfolio\n\n```python\n# get the efficient frontier as dataframe and plot it\nef = efficient_frontier_dataframe(annualized_returns, covariance_matrix)\nax = ef.plot(x=\"Volatility\", y=\"Return\", style=\".-\", figsize=(14,7),\n             title=\"2 Asset Portfolio Risk/Return\", legend=False)\nax.set_xlim(left=0)\nplt.ylabel(\"Return\")\n\n# show the different weights on the efficient frontier\nprint_weights_on_graph(ax, ef.Volatility, ef.Return, ef.weights)\n\n# find the MSR point and add a marker\nrets_msr = portfolio_return(msr, annualized_returns)\nvol_msr = portfolio_volatility(msr, covariance_matrix)\nax.plot(vol_msr, rets_msr, 'b*', markersize=10)\n\n# construct and plot the Capital Allocation Line\ncal_x = np.arange(0, vol_msr, (vol_msr-0)/100)\ncal_y = np.arange(risk_free_rate, rets_msr, (rets_msr-risk_free_rate)/100)\nax.plot(cal_x, cal_y, color=\"green\", linestyle=\"dashed\")\n\n# find the GMV point and add a marker\nrets_gmv = portfolio_return(gmv, annualized_returns)\nvol_gmv = portfolio_volatility(gmv, covariance_matrix)\nax.plot(vol_gmv, rets_gmv, 'rs', markersize=10)\n\n# locate the Mixed portfolio on CAL that has less risk than the GMV\nidx = np.argwhere(np.diff(np.sign(rets_gmv - cal_y))).flatten()\nax.plot(cal_x[idx], cal_y[idx], 'g^', markersize=10)\n\n# Add a custom legend for the markers\nplot_custom_legend()\nplt.show()\n```\n\n![png](modern-portfolio-theory-gmv-msr-mixed/modern-portfolio-theory-gmv-msr-mixed-8-0.png)\n    \n\n## MSR vs. GMV vs. Mixed Portfolio\n\nFrom the graph above we can pinpoint 3 interesting portfolios:\n\n* The GMV portfolio which depends solely on the covariance matrix.\n* The MSR portfolio which depends both on the covariance matrix and the expected returns.\n* The Mixed Portfolio which can yield same return as the GMV but with less risk.\n\nSo far, we took advantage of the historical data and constructed some portfolios. However, **historical returns are no guarantee of future returns**. Estimating returns is very difficult and requires experience, deep knowledge of the respective assets, continuous monitoring of the market and much more.\n\nSo, which portfolio is best to hold? The answer to that cannot be given with certainty!\n\nGMV does not take into account returns (or estimated expected returns) and thus makes it easier to calculate, but at the same time, constructing the covariance matrix for a long list of assets falls under the well known [Curse of Dimensionality](https://en.wikipedia.org/wiki/Curse_of_dimensionality) problem.\n\nMSR poses the difficulty of estimating expected returns and thus includes increased risk.\n\nThe mixed portfolio combines non risky assets with risky assets while lowering the risk. However, the covariance matrix is yet there to calculate.\n\nAll in all, each portfolio includes risk, which we call **model risk**. There are several ways to tackle this model risk and I will try to address them in future articles.\n\nUntil then, enjoy!\n","excerpt":""},"previousPost":{"slug":"inflation-looking-back","frontmatter":{"title":"Inflation - Looking Back!","description":"See how the piggy bank :P can digest part of your money.","date":"June 8, 2021","topic":{"id":"investing","name":"Investing","image":"investing.png","description":"The piggy bank digests a good amount of the savings! There is only one way to get away ... investing. BUT, there is a hidden enemy, Speculation!","color":"bg-green-300"},"tags":[{"id":"python","name":"python","image":"python-header.png","description":"Python is very handy in investing","color":"bg-green-300","icon":"python.svg"}],"author":{"id":"chris","name":"Chris","image":"https://s.gravatar.com/avatar/db809ecfa64d56da4bd9704c8393005a?s=80","description":"Software Engineer, passionate about ..."},"img":"/static/no-piggy-bank.png","colab":"https://drive.google.com/file/d/1DUyPzZAVkdg1QMiPNnkbBMB1cu2AT33o/view?usp=sharing"},"excerpt":"","content":"\nIn [Inflation - Planning Forward](/post/inflation-planning-future-cash-flows) we picked a static annual inflation rate to plan the financing of future expenses. In this article we will use the inflation historical data to determine how inflation had affected our savings. \n\n\n\u003cdetails\u003e\u003csummary\u003ePackage Installation\u003c/summary\u003e\n\u003cp\u003e\n\n```python\n%%capture\nimport pandas as pd\nimport numpy as np\nfrom datetime import datetime\nfrom dateutil.relativedelta import relativedelta\nimport matplotlib.pyplot as plt\n!pip install -q requests\n!pip install -q pyscbwrapper\n```\n\n\u003c/p\u003e\n\u003c/details\u003e\n\nLet us assume that 10 years ago a person started depositing 500\\$ of hers/his salary to the bank once a month.\n\n\n```python\nSAVINGS_PER_MONTH = 500\ndef generate_montly_savings_account_balance(monthly_savings):\n  today = datetime.today()\n  beginning_of_month = datetime(today.year, today.month, 1)\n  ten_years_ago = beginning_of_month - relativedelta(years=10)\n\n  savings_df = pd.DataFrame({\n      'date': pd.date_range(start=ten_years_ago, end=beginning_of_month, closed=None, freq='MS'),\n      'savings': monthly_savings\n      })\n  savings_df = savings_df.set_index(['date'])\n  return savings_df\n\nsavings_df = generate_montly_savings_account_balance(SAVINGS_PER_MONTH)\nsavings_accumulated = savings_df.savings.cumsum()\ncurrent_total = savings_accumulated[savings_df.index[-1]]\nsavings_plot = savings_accumulated.plot(figsize=(14,7))\nsavings_plot.set_title('Deposit account growth')\nsavings_plot.set_xlabel('Date')\nsavings_plot.set_ylabel('Amount')\nsavings_plot.axhline(current_total, color='g', linestyle='--', label='{:0.2f}'.format(current_total))\nsavings_plot.legend()\nplt.show()\n```\n\n![png](inflation-looking-back/inflation-looking-back_3_0.png)\n\nNext, let's fetch the US inflation rates from the [U.S. BUREAU OF LABOR STATISTICS](https://www.bls.gov/) and see how it advanced over the last decade.\n\n```python\ndef get_us_cpi(start_year='2012', end_year = '2021'):\n  '''\n    from https://www.bls.gov/developers/api_python.htm#python1\n  '''\n  import requests\n  import json\n  headers = {'Content-type': 'application/json'}\n  data = json.dumps({\"seriesid\": ['SUUR0000SA0'],\"startyear\":start_year, \"endyear\":end_year})\n  p = requests.post('https://api.bls.gov/publicAPI/v1/timeseries/data/', data=data, headers=headers)\n  json_data = json.loads(p.text)\n  cpi_list = []\n  for series in json_data['Results']['series']:\n    seriesId = series['seriesID']\n    for item in series['data']:\n      year = item['year']\n      period = item['period']\n      value = item['value']\n  \n      if 'M01' \u003c= period \u003c= 'M12':\n        datetime_object = datetime.strptime('{}-{}-01'.format(year, period[1:]), '%Y-%m-%d')\n        value = float(value)\n        cpi_list.append({\n                    'date': datetime_object,\n                    'cpi':  0.001 if value == 0.0 else value\n                  })\n  cpi= pd.DataFrame(cpi_list)\n  cpi['date'] = cpi['date'].astype('datetime64[ns]')\n  cpi = cpi.set_index('date')\n  cpi = cpi.sort_values(by='date')\n  return cpi\n\nus_cpi = get_us_cpi()\ninflation_rate_change_plot = us_cpi['cpi'].plot(figsize=(14,7))\ninflation_rate_change_plot.set_title('Inflation Monthly')\ninflation_rate_change_plot.set_xlabel('Date')\ninflation_rate_change_plot.set_ylabel('Infaltion Value')\nplt.show()\n```\n\n![png](inflation-looking-back/inflation-looking-back_5_0.png)\n    \nWe will now see how inflation would affect the purchase value of 1\\$. To do that we will calculate the monthly percentage change and then create what we previously referred to as [wealth index](/post/from-portfolio-wealth-index-to-index-fund) of 1\\$.\n\n\n```python\ndef plot_cpi_on_unit(cpi, unit='$'):\n  if 'pct_change' not in cpi.columns:\n    cpi['pct_change'] = cpi['cpi'].pct_change().dropna() \n  change_on_unit = 1 * (1+cpi['pct_change'][savings_df.index[0]:]).cumprod()\n  change_on_unit_plot = change_on_unit.plot(figsize=(14,7))\n  change_on_unit_plot.set_title(f\"How Inflation affects 1 {unit}\")\n  change_on_unit_plot.set_xlabel('Date')\n  change_on_unit_plot.set_ylabel(f\"Worth of 1 {unit}\")\n  change_on_unit_plot.axhline(change_on_unit[-1], color='g', linestyle='--', label='{:0.2f}'.format(change_on_unit[-1]))\n  change_on_unit_plot.legend()\n  plt.show()\n\nplot_cpi_on_unit(us_cpi, unit='$')\n```\n\n![png](inflation-looking-back/inflation-looking-back_8_0.png)\n\nWhat the graph shows above is that buying a product at 1\\$ in the beginning of 2012, this exact same product would today cost 1.15\\$. If you had saved the dollar in an account you would today miss 0.15\\$ to be able to purchase the product. In practice, you have lost 0.15\\$!\n\nNow that we have the percentage changes of the inflation, lets calculate the total loss of our savings all these years. For each month we add money to the cash account we have to start measuring the impact of inflation from that point on.\n\n```python\ndef plot_loss_on_savings(savings, cpi):\n  last_valid_index = cpi.last_valid_index()\n  s = pd.DataFrame(columns=savings.index.array, index=savings.index)\n  for col in s.columns:\n    wealth_index = savings['savings'][col] * (1+cpi['pct_change'][col:last_valid_index]).cumprod()\n    s[col] = wealth_index - savings['savings'][col]\n  inf_losses = s.sum(axis=1)\n  ax = inf_losses.plot(figsize=(14,7))\n  ax.set_title('Total loss due to inflation')\n  ax.set_xlabel('Date')\n  ax.set_ylabel('Loss in $')\n  ax.axhline(inf_losses[last_valid_index], color='r', linestyle='--', label='{:0.2f}'.format(inf_losses[last_valid_index]))\n  ax.legend()\n  ax.plot()\n\nplot_loss_on_savings(savings_df, us_cpi)\n```\n\n![png](inflation-looking-back/inflation-looking-back_11_0.png)\n    \n\n5349\\$ is the loss of saving in the bank without investing. That is almost 10% of the total account value!\n\n## Sweden\n\nHaving a special interest in the Swedish market, I will include the code needed to fetch inflation statistics from [SCB](https://www.scb.se/en/finding-statistics/statistics-by-subject-area/prices-and-consumption/consumer-price-index/consumer-price-index-cpi/pong/tables-and-graphs/cpi-with-fixed-interest-rate-cpif-cpif-ct-and-cpif-xe/cpif-annual-changes/).\n\n\n```python\ndef get_swedish_cpi():\n  \"\"\" Returns the CPI as a monthly percentage change.\n  For more information: https://github.com/kirajcg/pyscbwrapper/blob/master/pyscbwrapper.ipynb\n  \"\"\"\n  import re\n  from pyscbwrapper import SCB\n  scb = SCB('en', 'PR', 'PR0101', 'PR0101A', 'KPIFFMP')\n  scb.set_query(month=scb.get_variables()['month'])\n  data = scb.get_data()['data']\n  my_list = []\n  for obj in data:\n    date_scb_formatted = obj['key'][0].strip()  # this looks like '2020M06'\n    year_month_search = re.search('^(\\d{4})M(\\d{2})$', date_scb_formatted)\n    datetime_object = datetime.strptime('{}-{}-01'.format(year_month_search.group(1), year_month_search.group(2)), '%Y-%m-%d')\n    my_list.append({'date': datetime_object,\n                    'pct_change': float(obj['values'][0])/100\n                    })\n  cpi= pd.DataFrame(my_list)\n  cpi = cpi.set_index('date')\n  return cpi\n\nsw_cpi = get_swedish_cpi()\n\nplot_cpi_on_unit(sw_cpi, unit='SEK')\n```\n   \n![png](inflation-looking-back/inflation-looking-back_16_0.png)\n"},"nextPost":null},"tags":[{"id":"python","name":"python","image":"python-header.png","description":"Python is very handy in investing","color":"bg-green-300","icon":"python.svg","slug":"python","count":12},{"id":"statistics","name":"statistics","image":"statistics.jpg","description":"Statistics is the discipline that concerns the collection, organization, analysis, interpretation and presentation of data. - Wikipedia","color":"bg-green-300","icon":"statistics.svg","slug":"statistics","count":4},{"id":"cryptos","name":"cryptos","image":"bitcoin.png","description":"The amazing world of Blockchain opens one more chapter in the Investing.","color":"bg-green-300","icon":"bitcoin.svg","slug":"cryptos","count":1}],"sortedTopics":[{"id":"investing","name":"Investing","image":"investing.png","description":"The piggy bank digests a good amount of the savings! There is only one way to get away ... investing. BUT, there is a hidden enemy, Speculation!","color":"bg-green-300","slug":"investing","count":10},{"id":"mathematics","name":"Mathematics","image":"mathematics.png","description":"Investing, as part of the Science of Finance, is subject to the lows of Mathematics!","color":"bg-green-300","slug":"mathematics","count":4},{"id":"automation","name":"Automation","image":"automation.jpg","description":"Spending time to do the same thing over and over again is tedious! Thus, I like to automate as much as possible.","color":"bg-green-300","slug":"automation","count":2}],"allTopics":[{"id":"mathematics","name":"Mathematics","image":"mathematics.png","description":"Investing, as part of the Science of Finance, is subject to the lows of Mathematics!","color":"bg-green-300"},{"id":"automation","name":"Automation","image":"automation.jpg","description":"Spending time to do the same thing over and over again is tedious! Thus, I like to automate as much as possible.","color":"bg-green-300"},{"id":"investing","name":"Investing","image":"investing.png","description":"The piggy bank digests a good amount of the savings! There is only one way to get away ... investing. BUT, there is a hidden enemy, Speculation!","color":"bg-green-300"}],"slug":"modern-portfolio-theory-gmv-msr-mixed"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"modern-portfolio-theory-gmv-msr-mixed"},"buildId":"zywHXz7RMTdGgwlNJqk_l","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-6d6446214035a37ee7d9.js"></script><script src="/_next/static/chunks/main-9b805fa25f3c727dff23.js" async=""></script><script src="/_next/static/chunks/webpack-eb080e3f091731f228fb.js" async=""></script><script src="/_next/static/chunks/framework.1d36bc031662b4dc4c28.js" async=""></script><script src="/_next/static/chunks/aafb98ef.d6f2610c02ca1f2f8023.js" async=""></script><script src="/_next/static/chunks/commons.8953387921da877f7077.js" async=""></script><script src="/_next/static/chunks/c993a675fc23e2c5b16b0cdfa51e09fd2f5f8f80.b94a6da2562f8dbfcbf3.js" async=""></script><script src="/_next/static/chunks/pages/_app-8d389892d8851416e9e3.js" async=""></script><script src="/_next/static/chunks/cb1608f2.374587486deb2a784e19.js" async=""></script><script src="/_next/static/chunks/a9a7754c.d9f31489d713bac24f81.js" async=""></script><script src="/_next/static/chunks/60273576.45a211ac3b19a5bdcfc0.js" async=""></script><script src="/_next/static/chunks/28b78d933298d505941537c6c1190f6a19d63af1.0f80399fe1f963dbc23b.js" async=""></script><script src="/_next/static/chunks/f485e41bcb118a628b46c21556cf62824a9a6265.b5d54d4427b3ca2aa455.js" async=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-c295bfa18e28c0faf5ff.js" async=""></script><script src="/_next/static/zywHXz7RMTdGgwlNJqk_l/_buildManifest.js" async=""></script><script src="/_next/static/zywHXz7RMTdGgwlNJqk_l/_ssgManifest.js" async=""></script></body></html>