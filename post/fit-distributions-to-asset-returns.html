<!DOCTYPE html><html lang="en-US"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-180222243-1"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-180222243-1', {
              page_path: window.location.pathname,
            });
          </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Fit Multiple Distributions to Asset Returns!</title><meta name="description" content="Why normal distribution is not preferred for stock returns analysis."/><meta property="og:type" content="website"/><meta name="og:title" property="og:title" content="Fit Multiple Distributions to Asset Returns!"/><meta name="og:description" property="og:description" content="Why normal distribution is not preferred for stock returns analysis."/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Fit Multiple Distributions to Asset Returns!"/><meta name="twitter:description" content="Why normal distribution is not preferred for stock returns analysis."/><meta name="twitter:creator" content="investingsnipts"/><link rel="icon" type="image/png" href="/static/favicon.ico"/><link rel="apple-touch-icon" href="/static/favicon.ico"/><meta name="next-head-count" content="13"/><link rel="preload" href="/_next/static/css/2d2f87205aa6ef8b4f4a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2d2f87205aa6ef8b4f4a.css" data-n-g=""/><link rel="preload" href="/_next/static/css/276cb3c5109fbc96253b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/276cb3c5109fbc96253b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/68cca870bc3fca5c9cb8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/68cca870bc3fca5c9cb8.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-9b805fa25f3c727dff23.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-eb080e3f091731f228fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1d36bc031662b4dc4c28.js" as="script"/><link rel="preload" href="/_next/static/chunks/aafb98ef.d6f2610c02ca1f2f8023.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.8953387921da877f7077.js" as="script"/><link rel="preload" href="/_next/static/chunks/c993a675fc23e2c5b16b0cdfa51e09fd2f5f8f80.7eda6f7f6f606b39097e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-8d389892d8851416e9e3.js" as="script"/><link rel="preload" href="/_next/static/chunks/cb1608f2.374587486deb2a784e19.js" as="script"/><link rel="preload" href="/_next/static/chunks/a9a7754c.d9f31489d713bac24f81.js" as="script"/><link rel="preload" href="/_next/static/chunks/60273576.45a211ac3b19a5bdcfc0.js" as="script"/><link rel="preload" href="/_next/static/chunks/28b78d933298d505941537c6c1190f6a19d63af1.41b7ccb1b9a7b85862b6.js" as="script"/><link rel="preload" href="/_next/static/chunks/f485e41bcb118a628b46c21556cf62824a9a6265.b5d54d4427b3ca2aa455.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/post/%5Bslug%5D-c295bfa18e28c0faf5ff.js" as="script"/></head><body><div id="__next"><div class="overflow-hidden items-center justify-center bg-gray-100 max-w-screen-xl mx-auto"><header class="container"><nav class="relative select-none bg-grey lg:flex lg:items-stretch w-full pt-4"><div class="flex flex-no-shrink items-stretch h-12"><a class="flex-no-grow flex-no-shrink relative p-2 leading-normal text-3xl lg:text-5xl no-underline font-semibold flex items-center" href="/">InvestingSnippets</a><button id="hamburgerMenu" type="button" class="block lg:hidden cursor-pointer ml-auto relative w-12 h-12 p-4"><svg id="hamburgerBtn" class="visible fill-current text-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg><svg id="hamburgerClose" class="hidden fill-current text-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"></path></svg></button></div><div class="lg:flex lg:items-stretch lg:flex-no-shrink lg:flex-grow hidden" id="mobileMenu"><div class="lg:flex lg:items-stretch lg:justify-end ml-auto"><a class="flex-no-grow flex-no-shrink relative py-2 px-4 leading-normal font-semibold text-gray-700 no-underline flex items-center hover:bg-grey-dark" href="/topic/mathematics"><span>Mathematics</span></a><a class="flex-no-grow flex-no-shrink relative py-2 px-4 leading-normal font-semibold text-gray-700 no-underline flex items-center hover:bg-grey-dark" href="/topic/automation"><span>Automation</span></a><a class="flex-no-grow flex-no-shrink relative py-2 px-4 leading-normal font-semibold text-gray-700 no-underline flex items-center hover:bg-grey-dark" href="/topic/investing"><span>Investing</span></a></div></div></nav></header><main class="block lg:flex lg:space-x-2 px-2 lg:p-0 mt-10 mb-10"><div class="w-full lg:w-2/3 px-2"><article><header class="mb-8"><p class="text-sm mb-2"><a class="" href="/">Home</a> &gt; <a class="" href="/topic/investing">Investing</a> &gt; </p><h1 class="mb-2 text-3xl lg:text-4xl leading-none font-display font-semibold">Fit Multiple Distributions to Asset Returns!</h1><p class="text-sm mb-2">March 28, 2021<!-- --> <!-- -->by<!-- --> <!-- -->Chris</p><div class="flex justify-end mt-2 mr-5"><a class="text-gray-600" href="/tag/python"><img class="filter-orange-700 h-4 w-4 m-1 inline-block" alt="python" src="https://www.investingsnippets.com/static/python.svg" data-srcset="https://www.investingsnippets.com/static/python.svg"/>python</a></div><div class="flex justify-end mt-2 mr-5"><a target="_blank" rel="noopener noreferrer" href="https://colab.research.google.com/drive/1p3KbU09vOrplisEzMFEQqGV5Jtuxr3FC?usp=sharing"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></div></header><div class="mb-4 prose-lg max-w-none markdown-styles_reactMarkDown__3jmlK"><p>Earlier in <a href="post/are-stock-returns-normally-distributed">Are Stock Returns Normally Distributed?</a> we went through different ways to validate when asset returns are normally distributed. While we used only one stock to prove that stock returns are not normally distributed, the phenomenon applies to any volatile asset, in general.</p>
<p>The question though is: Really, which distribution do returns follow?</p>
<p>Below we load the MSFT stock returns as we did before!</p>
<details><summary>Package Installation</summary>
<p>
</p><pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#a9b7c6">%</span><span class="token" style="color:#a9b7c6">%</span><span>capture
</span><span></span><span class="token" style="color:#a9b7c6">%</span><span>pip install yahoofinancials
</span><span></span><span class="token" style="color:#cc7832">from</span><span> yahoofinancials </span><span class="token" style="color:#cc7832">import</span><span> YahooFinancials
</span><span></span><span class="token" style="color:#cc7832">import</span><span> pandas </span><span class="token" style="color:#cc7832">as</span><span> pd
</span><span></span><span class="token" style="color:#cc7832">import</span><span> matplotlib
</span><span></span><span class="token" style="color:#cc7832">import</span><span> matplotlib</span><span class="token" style="color:#a9b7c6">.</span><span>pyplot </span><span class="token" style="color:#cc7832">as</span><span> plt
</span><span></span><span class="token" style="color:#cc7832">import</span><span> seaborn </span><span class="token" style="color:#cc7832">as</span><span> sns
</span><span></span><span class="token" style="color:#cc7832">import</span><span> dateutil</span><span class="token" style="color:#a9b7c6">.</span><span>parser</span></code></div></pre>
<p></p>
</details>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">retrieve_stock_data</span><span class="token" style="color:#a9b7c6">(</span><span>ticker</span><span class="token" style="color:#a9b7c6">,</span><span> start</span><span class="token" style="color:#a9b7c6">,</span><span> end</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    json </span><span class="token" style="color:#a9b7c6">=</span><span> YahooFinancials</span><span class="token" style="color:#a9b7c6">(</span><span>ticker</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>get_historical_price_data</span><span class="token" style="color:#a9b7c6">(</span><span>start</span><span class="token" style="color:#a9b7c6">,</span><span> end</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&quot;daily&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>    columns</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;adjclose&quot;</span><span class="token" style="color:#a9b7c6">]</span><span>  </span><span class="token" style="color:#808080"># [&quot;open&quot;,&quot;close&quot;,&quot;adjclose&quot;]</span><span>
</span><span>    df </span><span class="token" style="color:#a9b7c6">=</span><span> pd</span><span class="token" style="color:#a9b7c6">.</span><span>DataFrame</span><span class="token" style="color:#a9b7c6">(</span><span>columns</span><span class="token" style="color:#a9b7c6">=</span><span>columns</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">for</span><span> row </span><span class="token" style="color:#cc7832">in</span><span> json</span><span class="token" style="color:#a9b7c6">[</span><span>ticker</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;prices&quot;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>        d </span><span class="token" style="color:#a9b7c6">=</span><span> dateutil</span><span class="token" style="color:#a9b7c6">.</span><span>parser</span><span class="token" style="color:#a9b7c6">.</span><span>isoparse</span><span class="token" style="color:#a9b7c6">(</span><span>row</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;formatted_date&quot;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>        df</span><span class="token" style="color:#a9b7c6">.</span><span>loc</span><span class="token" style="color:#a9b7c6">[</span><span>d</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>row</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;adjclose&quot;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#808080"># [row[&quot;open&quot;], row[&quot;close&quot;], row[&quot;adjclose&quot;]]</span><span>
</span><span>    df</span><span class="token" style="color:#a9b7c6">.</span><span>index</span><span class="token" style="color:#a9b7c6">.</span><span>name </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6a8759">&quot;date&quot;</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> df
</span>
<span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">normal_rets</span><span class="token" style="color:#a9b7c6">(</span><span>S</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> S</span><span class="token" style="color:#a9b7c6">.</span><span>pct_change</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>dropna</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span>stock_prices </span><span class="token" style="color:#a9b7c6">=</span><span> retrieve_stock_data</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;MSFT&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&quot;2019-01-01&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&quot;2020-01-01&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span>rets </span><span class="token" style="color:#a9b7c6">=</span><span> normal_rets</span><span class="token" style="color:#a9b7c6">(</span><span>stock_prices</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>dropna</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>rets</span><span class="token" style="color:#a9b7c6">.</span><span>columns </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;returns&#x27;</span><span class="token" style="color:#a9b7c6">]</span></code></div></pre>
<h2>Fit all known distributions</h2>
<p>Instead of trying to fit the Gaussian Distribution to our data, we will try to fit all the known (scipy.stats implementations) distributions and see which one (or ones) fits the data best.</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">import</span><span> numpy </span><span class="token" style="color:#cc7832">as</span><span> np
</span><span></span><span class="token" style="color:#cc7832">from</span><span> scipy</span><span class="token" style="color:#a9b7c6">.</span><span>stats</span><span class="token" style="color:#a9b7c6">.</span><span>_continuous_distns </span><span class="token" style="color:#cc7832">import</span><span> _distn_names
</span><span></span><span class="token" style="color:#cc7832">import</span><span> scipy</span><span class="token" style="color:#a9b7c6">.</span><span>stats </span><span class="token" style="color:#cc7832">as</span><span> st
</span><span></span><span class="token" style="color:#cc7832">import</span><span> warnings
</span>
<span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">fit_all_distributions</span><span class="token" style="color:#a9b7c6">(</span><span>data</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    </span><span class="token triple-quoted-string" style="color:#6a8759">&quot;&quot;&quot;
</span><span class="token triple-quoted-string" style="color:#6a8759">    Returns: Dict of the density function and the Sum of Squared Errors (SSE)
</span><span class="token triple-quoted-string" style="color:#6a8759">    &quot;&quot;&quot;</span><span>
</span><span>    </span><span class="token" style="color:#808080"># Get histogram of original data. First, get the x for the pdf</span><span>
</span><span>    </span><span class="token" style="color:#808080"># second, get y to calculate the distance between the </span><span>
</span><span>    </span><span class="token" style="color:#808080"># distribution and the real data</span><span>
</span><span>    y</span><span class="token" style="color:#a9b7c6">,</span><span> x </span><span class="token" style="color:#a9b7c6">=</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>histogram</span><span class="token" style="color:#a9b7c6">(</span><span>data</span><span class="token" style="color:#a9b7c6">,</span><span> bins</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;auto&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> density</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#cc7832">True</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>    x </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>x </span><span class="token" style="color:#a9b7c6">+</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>roll</span><span class="token" style="color:#a9b7c6">(</span><span>x</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">:</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">/</span><span> </span><span class="token" style="color:#6897bb">2.0</span><span>
</span>
<span>    dist_fit </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">}</span><span>
</span>
<span>    </span><span class="token" style="color:#808080"># Estimate distribution parameters from data</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">for</span><span> distname </span><span class="token" style="color:#cc7832">in</span><span> _distn_names</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>        distribution </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#e8bf6a">getattr</span><span class="token" style="color:#a9b7c6">(</span><span>st</span><span class="token" style="color:#a9b7c6">,</span><span> distname</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span>        </span><span class="token" style="color:#808080"># Try to fit the distribution</span><span>
</span><span>        </span><span class="token" style="color:#cc7832">try</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>            </span><span class="token" style="color:#808080"># Ignore warnings for data that can&#x27;t be fit</span><span>
</span><span>            </span><span class="token" style="color:#cc7832">with</span><span> warnings</span><span class="token" style="color:#a9b7c6">.</span><span>catch_warnings</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>                warnings</span><span class="token" style="color:#a9b7c6">.</span><span>filterwarnings</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&#x27;ignore&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span>                </span><span class="token" style="color:#808080"># fit dist to data</span><span>
</span><span>                params </span><span class="token" style="color:#a9b7c6">=</span><span> distribution</span><span class="token" style="color:#a9b7c6">.</span><span>fit</span><span class="token" style="color:#a9b7c6">(</span><span>data</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span>                </span><span class="token" style="color:#808080"># Calculate fitted PDF and error</span><span>
</span><span>                pdf </span><span class="token" style="color:#a9b7c6">=</span><span> distribution</span><span class="token" style="color:#a9b7c6">.</span><span>pdf</span><span class="token" style="color:#a9b7c6">(</span><span>x</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">*</span><span>params</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>                sse </span><span class="token" style="color:#a9b7c6">=</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#e8bf6a">sum</span><span class="token" style="color:#a9b7c6">(</span><span>np</span><span class="token" style="color:#a9b7c6">.</span><span>power</span><span class="token" style="color:#a9b7c6">(</span><span>y </span><span class="token" style="color:#a9b7c6">-</span><span> pdf</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6897bb">2.0</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>                dist_fit</span><span class="token" style="color:#a9b7c6">[</span><span>distname</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">}</span><span>
</span><span>                dist_fit</span><span class="token" style="color:#a9b7c6">[</span><span>distname</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;pdf&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> pdf
</span><span>                dist_fit</span><span class="token" style="color:#a9b7c6">[</span><span>distname</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;sse&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> sse
</span><span>        </span><span class="token" style="color:#cc7832">except</span><span> Exception</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>            </span><span class="token" style="color:#cc7832">pass</span><span>
</span>
<span>    </span><span class="token" style="color:#cc7832">return</span><span> dist_fit</span></code></div></pre>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>dist_fit </span><span class="token" style="color:#a9b7c6">=</span><span> fit_all_distributions</span><span class="token" style="color:#a9b7c6">(</span><span>rets</span><span class="token" style="color:#a9b7c6">.</span><span>returns</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span></span><span class="token" style="color:#e8bf6a">len</span><span class="token" style="color:#a9b7c6">(</span><span>dist_fit</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<pre><code>99
</code></pre>
<p>What? 99? :) Well, It should not be of a surprise that several distributions would fit the data. But the &quot;fit&quot; could be really off :) For example an exponential or even a uniform distribution could fit the data, but the squared error (the distance between the actual data points and the respective distribution points) would be really large compared to distributions that approximate the histogram of our data.</p>
<p>Let&#x27;s get the 15 distributions with the lowest SSE (the ones that best fit the data).</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>dname_list </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span>
</span><span>sse_list </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span>
</span><span>pdf </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">]</span><span>
</span><span></span><span class="token" style="color:#cc7832">for</span><span> dname </span><span class="token" style="color:#cc7832">in</span><span> dist_fit</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>  dname_list</span><span class="token" style="color:#a9b7c6">.</span><span>append</span><span class="token" style="color:#a9b7c6">(</span><span>dname</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  sse_list</span><span class="token" style="color:#a9b7c6">.</span><span>append</span><span class="token" style="color:#a9b7c6">(</span><span>dist_fit</span><span class="token" style="color:#a9b7c6">[</span><span>dname</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;sse&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  pdf</span><span class="token" style="color:#a9b7c6">.</span><span>append</span><span class="token" style="color:#a9b7c6">(</span><span>dist_fit</span><span class="token" style="color:#a9b7c6">[</span><span>dname</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;pdf&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span>df </span><span class="token" style="color:#a9b7c6">=</span><span> pd</span><span class="token" style="color:#a9b7c6">.</span><span>DataFrame</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#6a8759">&#x27;dist&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span> dname_list</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&#x27;sse&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span> sse_list</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&#x27;pdf&#x27;</span><span class="token" style="color:#a9b7c6">:</span><span>pdf</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>df </span><span class="token" style="color:#a9b7c6">=</span><span> df</span><span class="token" style="color:#a9b7c6">.</span><span>sort_values</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&#x27;sse&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>df_15 </span><span class="token" style="color:#a9b7c6">=</span><span> df</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">:</span><span class="token" style="color:#6897bb">15</span><span class="token" style="color:#a9b7c6">]</span><span>
</span>df_15
</code></div></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align:right">
      <th></th>
      <th>dist</th>
      <th>sse</th>
      <th>pdf</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>52</th>
      <td>laplace</td>
      <td>148.651407</td>
      <td>[1.1152568034938246, 1.787521047421414, 2.8650...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>gennorm</td>
      <td>164.078771</td>
      <td>[0.8367820735065007, 1.5154080142470994, 2.686...</td>
    </tr>
    <tr>
      <th>17</th>
      <td>dweibull</td>
      <td>176.635717</td>
      <td>[0.8793256263714793, 1.5296378660593237, 2.635...</td>
    </tr>
    <tr>
      <th>16</th>
      <td>dgamma</td>
      <td>191.050465</td>
      <td>[0.8552917947109029, 1.4658525793451274, 2.502...</td>
    </tr>
    <tr>
      <th>44</th>
      <td>hypsecant</td>
      <td>213.097016</td>
      <td>[0.7998518705010982, 1.383459240576739, 2.3919...</td>
    </tr>
    <tr>
      <th>48</th>
      <td>norminvgauss</td>
      <td>230.918089</td>
      <td>[0.9381562968673568, 1.5495654573259756, 2.580...</td>
    </tr>
    <tr>
      <th>89</th>
      <td>tukeylambda</td>
      <td>232.611350</td>
      <td>[0.7436837695141802, 1.2913003803519416, 2.270...</td>
    </tr>
    <tr>
      <th>51</th>
      <td>johnsonsu</td>
      <td>241.389639</td>
      <td>[0.9016851129004099, 1.4956683047905153, 2.519...</td>
    </tr>
    <tr>
      <th>69</th>
      <td>t</td>
      <td>243.179748</td>
      <td>[0.715121368715189, 1.2350959953532723, 2.1881...</td>
    </tr>
    <tr>
      <th>70</th>
      <td>nct</td>
      <td>250.858249</td>
      <td>[0.8688042602613769, 1.4480199008827952, 2.464...</td>
    </tr>
    <tr>
      <th>30</th>
      <td>genlogistic</td>
      <td>260.651315</td>
      <td>[0.8748265286114669, 1.5253897598139983, 2.650...</td>
    </tr>
    <tr>
      <th>56</th>
      <td>logistic</td>
      <td>263.548520</td>
      <td>[0.6451586874653275, 1.2223472162162576, 2.299...</td>
    </tr>
    <tr>
      <th>10</th>
      <td>burr12</td>
      <td>271.252587</td>
      <td>[0.7636589016658705, 1.3949317532979122, 2.529...</td>
    </tr>
    <tr>
      <th>12</th>
      <td>cauchy</td>
      <td>272.502209</td>
      <td>[1.4774507773037833, 1.8876747700442502, 2.491...</td>
    </tr>
    <tr>
      <th>55</th>
      <td>levy_stable</td>
      <td>285.357222</td>
      <td>[0.7622030792115081, 1.252074636445709, 2.2016...</td>
    </tr>
  </tbody></table>
</div>
<p>Interestingly <code>laplace</code> was the distribution which approximates best the initial data. However, several other distributions are not that far from <code>laplace</code> with regards to SSE distances. To showcase that, let&#x27;s see how the distributions visually correlate with the actual data.</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>y</span><span class="token" style="color:#a9b7c6">,</span><span> x </span><span class="token" style="color:#a9b7c6">=</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>histogram</span><span class="token" style="color:#a9b7c6">(</span><span>rets</span><span class="token" style="color:#a9b7c6">.</span><span>returns</span><span class="token" style="color:#a9b7c6">,</span><span> bins</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">19</span><span class="token" style="color:#a9b7c6">,</span><span> density</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#cc7832">True</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>x </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>x </span><span class="token" style="color:#a9b7c6">+</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>roll</span><span class="token" style="color:#a9b7c6">(</span><span>x</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">:</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">/</span><span> </span><span class="token" style="color:#6897bb">2.0</span><span>
</span><span>ax </span><span class="token" style="color:#a9b7c6">=</span><span> rets</span><span class="token" style="color:#a9b7c6">.</span><span>returns</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>kind</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;hist&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> bins</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">19</span><span class="token" style="color:#a9b7c6">,</span><span> figsize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">14</span><span class="token" style="color:#a9b7c6">,</span><span class="token" style="color:#6897bb">7</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span> density</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#cc7832">True</span><span class="token" style="color:#a9b7c6">,</span><span> alpha</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">0.5</span><span class="token" style="color:#a9b7c6">,</span><span> 
</span><span>                       color</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#e8bf6a">list</span><span class="token" style="color:#a9b7c6">(</span><span>matplotlib</span><span class="token" style="color:#a9b7c6">.</span><span>rcParams</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;axes.prop_cycle&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;color&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span></span><span class="token" style="color:#cc7832">for</span><span> index</span><span class="token" style="color:#a9b7c6">,</span><span> row </span><span class="token" style="color:#cc7832">in</span><span> df_15</span><span class="token" style="color:#a9b7c6">.</span><span>iterrows</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>  pd</span><span class="token" style="color:#a9b7c6">.</span><span>Series</span><span class="token" style="color:#a9b7c6">(</span><span>row</span><span class="token" style="color:#a9b7c6">.</span><span>pdf</span><span class="token" style="color:#a9b7c6">,</span><span> x</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>ax</span><span class="token" style="color:#a9b7c6">=</span><span>ax</span><span class="token" style="color:#a9b7c6">,</span><span> label</span><span class="token" style="color:#a9b7c6">=</span><span>row</span><span class="token" style="color:#a9b7c6">.</span><span>dist</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>set_title</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">u&#x27;All Fitted Distributions&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>set_xlabel</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">u&#x27;Returns&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>set_ylabel</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&#x27;Frequency&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>plt</span><span class="token" style="color:#a9b7c6">.</span><span>legend</span><span class="token" style="color:#a9b7c6">(</span><span>loc</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;upper left&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<p><div class="w-full mx-auto flex justify-center"><img class="lazyload blur-up" alt="png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAAAklEQVR4AewaftIAAACySURBVCXBzWrCQBgF0PtNQoykJEPtLLIodeGiz+FjdOvz+FpdlCzc6MYKgiG0KMHfJpO0c8vgOfK53rx1vZ1preF9LFaRSeMgHg5tnucOd+cwUBw756Yk4aVZhiQZwJgRSMITkVqdzpdIRCAiYG/x3YdY7n9way08EYGnnoyxWmvQ/aHYHlA1gq/fGGW1BwmQhBfuyrJoGM13VaXq5Nkdy3UQp4/yXneuJd1Dd1Ivk9frPyPGUKfPH3i4AAAAAElFTkSuQmCC" data-srcset="/_next/static/images/fit_distributions_to_asset_returns_8_1-ae487d5424d930c1bd39bcd5c7d02329.png"/></div></p>
<p>An interesting observation from the graph above is that all there is almost a concurrence of the distribution legs and tails. On the contrary they do not really agree on the height of the mean bar, but all of them approximate it pretty well.</p>
<p>So, are we done yet? Shall we, from now on, use <code>laplace</code> as the distribution to represent asset returns?</p>
<p>Unfortunately no :(! And the reason why, is that there are several other parameters that can easily interfere with what we expect:</p>
<ul>
<li>The number of data points (daily vs. minute vs. monthly)</li>
<li>The selected period. (last 3 months will give different result compared to last 6 months or 1 year, or more)</li>
<li>The reason we use a distribution (to measure risk? to predict returns? etc.)</li>
</ul>
<h2>Why T-Student is often used?</h2>
<p>You might have wondered, why so many people use the T-Student distribution when analyzing stock return data!</p>
<p>The answer to that has to do with the risk that an investor can accept when placing money to a risky asset. There are different ways to measure risk and one of them is the risk estimation based on distributions (model risk).</p>
<p>Say for example, in the MSFT scenario above, that we would like to avoid any daily price drop of more than 2%. And we ask, how confident are we that there will be no drop of more than 2% tomorrow (since we have daily returns)?</p>
<p>The answer to that question can be derived from the CDF (Cumulative Distribution Function) of a distribution (which is the area under the PDF (Point Distribution Function))</p>
<p>Here is how the normal and student-t PDF looks like for MSFT returns in the period we test.</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>ax </span><span class="token" style="color:#a9b7c6">=</span><span> rets</span><span class="token" style="color:#a9b7c6">.</span><span>returns</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>kind</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;hist&#x27;</span><span class="token" style="color:#a9b7c6">,</span><span> bins</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">19</span><span class="token" style="color:#a9b7c6">,</span><span> figsize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">14</span><span class="token" style="color:#a9b7c6">,</span><span class="token" style="color:#6897bb">7</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span> density</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#cc7832">True</span><span class="token" style="color:#a9b7c6">,</span><span> alpha</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6897bb">0.5</span><span class="token" style="color:#a9b7c6">,</span><span> 
</span><span>                       color</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#e8bf6a">list</span><span class="token" style="color:#a9b7c6">(</span><span>matplotlib</span><span class="token" style="color:#a9b7c6">.</span><span>rcParams</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;axes.prop_cycle&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;color&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span>student_t_pdf </span><span class="token" style="color:#a9b7c6">=</span><span> df</span><span class="token" style="color:#a9b7c6">.</span><span>loc</span><span class="token" style="color:#a9b7c6">[</span><span>df</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;dist&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">==</span><span> </span><span class="token" style="color:#6a8759">&#x27;t&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">.</span><span>pdf</span><span class="token" style="color:#a9b7c6">.</span><span>values</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">]</span><span>
</span><span>pd</span><span class="token" style="color:#a9b7c6">.</span><span>Series</span><span class="token" style="color:#a9b7c6">(</span><span>student_t_pdf</span><span class="token" style="color:#a9b7c6">,</span><span> x</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>ax</span><span class="token" style="color:#a9b7c6">=</span><span>ax</span><span class="token" style="color:#a9b7c6">,</span><span> label</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;t&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>normal_pdf </span><span class="token" style="color:#a9b7c6">=</span><span> df</span><span class="token" style="color:#a9b7c6">.</span><span>loc</span><span class="token" style="color:#a9b7c6">[</span><span>df</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;dist&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">==</span><span> </span><span class="token" style="color:#6a8759">&#x27;norm&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">.</span><span>pdf</span><span class="token" style="color:#a9b7c6">.</span><span>values</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">]</span><span>
</span><span>pd</span><span class="token" style="color:#a9b7c6">.</span><span>Series</span><span class="token" style="color:#a9b7c6">(</span><span>normal_pdf</span><span class="token" style="color:#a9b7c6">,</span><span> x</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>ax</span><span class="token" style="color:#a9b7c6">=</span><span>ax</span><span class="token" style="color:#a9b7c6">,</span><span> label</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;normal&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>
<span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>set_title</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">u&#x27;Student-T and Normal Distributions&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>set_xlabel</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">u&#x27;Returns&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>set_ylabel</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&#x27;Frequency&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>plt</span><span class="token" style="color:#a9b7c6">.</span><span>legend</span><span class="token" style="color:#a9b7c6">(</span><span>loc</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;upper left&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<p><div class="w-full mx-auto flex justify-center"><img class="lazyload blur-up" alt="png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAAAklEQVR4AewaftIAAACrSURBVCXBTQqCUBQG0O8+tSdkBg2CGohvKy2jaetpXTVo1LQIJPtxImq+NJJ7UzqHTufL2nVoo7VGkiTOrWy9xWREANgY88Ff5frai5VSKxFBFEV4ZzXCsYdZoCEiGBBRrqy1I/SICMyMp+1wzN6o2g4DIsJABUHwQY9ZsE9KPOovHrbDrWjAAogIBu41TQ+Fmm6ze6pyf85lenb8cEa7/MuvZsnTrlDGxPUP6O5QZcreFIQAAAAASUVORK5CYII=" data-srcset="/_next/static/images/fit_distributions_to_asset_returns_10_1-613aa404facfbf91b3e91d5fe2085d0d.png"/></div></p>
<p>Back to our question now. How confident are we that tomorrow the price will not drop below 2% (-0.02)?</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>norm_cdf </span><span class="token" style="color:#a9b7c6">=</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>cumsum</span><span class="token" style="color:#a9b7c6">(</span><span>normal_pdf</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>t_cdf </span><span class="token" style="color:#a9b7c6">=</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>cumsum</span><span class="token" style="color:#a9b7c6">(</span><span>student_t_pdf</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>fig</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>ax1</span><span class="token" style="color:#a9b7c6">,</span><span> ax2</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> plt</span><span class="token" style="color:#a9b7c6">.</span><span>subplots</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6897bb">2</span><span class="token" style="color:#a9b7c6">,</span><span> figsize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">14</span><span class="token" style="color:#a9b7c6">,</span><span class="token" style="color:#6897bb">7</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>fig</span><span class="token" style="color:#a9b7c6">.</span><span>suptitle</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&#x27;CDF for Normal and T dists&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax1</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>x</span><span class="token" style="color:#a9b7c6">,</span><span> norm_cdf</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax2</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>x</span><span class="token" style="color:#a9b7c6">,</span><span> t_cdf</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>plt</span><span class="token" style="color:#a9b7c6">.</span><span>show</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<p><div class="w-full mx-auto flex justify-center"><img class="lazyload blur-up" alt="png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAAAklEQVR4AewaftIAAACLSURBVI3BsQ2CUBCA4f+4B+5gY+sw0ugMLuAuroGFDY0z2LiACclLTGxslHC8MyS8ws7vkxjjGlgySYnzqXlTLR51Xa/I+s8QzOygqntSAk9struLmTXufsQdRoOqegYyT6CBH2mEUDIp+FMhIjAaqJKJCLiDCFmIXXeTQloKZXYtg96Hvm/RwOz1BUvRNT9iXQa7AAAAAElFTkSuQmCC" data-srcset="/_next/static/images/fit_distributions_to_asset_returns_12_0-cdc1f2e6e7535dd3fd6ef03443506d9b.png"/></div></p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>norm_cdf</span><span class="token" style="color:#a9b7c6">[</span><span>np</span><span class="token" style="color:#a9b7c6">.</span><span>where</span><span class="token" style="color:#a9b7c6">(</span><span>x </span><span class="token" style="color:#a9b7c6">&lt;=</span><span> </span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">0.02</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">]</span></code></div></pre>
<pre><code>9.876651890962592
</code></pre>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>t_cdf</span><span class="token" style="color:#a9b7c6">[</span><span>np</span><span class="token" style="color:#a9b7c6">.</span><span>where</span><span class="token" style="color:#a9b7c6">(</span><span>x </span><span class="token" style="color:#a9b7c6">&lt;=</span><span> </span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">0.02</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">]</span></code></div></pre>
<pre><code>8.086428763077489
</code></pre>
<p>According to the normal distribution, there is 9.9% probability that the price will drop below 2% while only 8.1% student-t probability. Someone, based on their risk tolerance, would be more confident to place some more money knowing that the estimate is much closer to the reality (well, historical reality)!</p>
<p>But, again, it is really up to us to use any distribution we feel comfortable with, based on the data we have, our risk level, and of course (when it comes to statistics) the tools to do our analysis easier.</p></div><hr class="mt-4"/><footer></footer></article><nav class="flex flex-wrap justify-between mb-10"><a class="text-lg font-bold" href="/post/a-tradeable-investment-portfolio-as-erc20-token">←<!-- --> <!-- -->A Tradeable Investment Portfolio as ERC20 Token</a><a class="text-lg font-bold" href="/post/modern-portfolio-theory">Modern Portfolio Theory - Part 1<!-- --> <!-- -->→</a></nav><div shortname="investingsnippets" config="[object Object]" id="disqus_thread"></div></div><div class="w-full lg:w-1/3 px-2"><div class="border border-dotted mt-4 visible lg:invisible lg:mt-0"></div><div class="my-4 lg:mt-0"><content><h5 class="font-semibold text-lg uppercase text-gray-700">About<!-- --> <!-- -->InvestingSnippets</h5><div class="flex-auto flex-no-wrap flex-shrink-0 text-center pt-5"><a href="https://twitter.com/investingsnipts" class="inline-block hover:text-blue-700 no-label px-2" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="25px"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://github.com/investingsnippets" class="inline-block hover:text-blue-700 no-label px-2" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" width="25px"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://www.linkedin.com/in/investingsnippets/" class="inline-block hover:text-blue-700 no-label px-2" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="25px"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></div><div class="flex items-center my-5"><p class="text-base leading-7">Driven by my passion to always dive deep in new knowledge, I started this blog as an attempt to give my own simplified view on how I apply my Software Engineering skills and background in Mathematics to Investing! NO financial advice or consulting is provided! I use python and try to automate as much as possible.</p></div><div class="flex"><a href="https://twitter.com/investingsnipts" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false"> </a></div></content></div><div class="border border-dotted"></div><div class="my-2 lg:my-4"><content><h5 class="font-semibold text-lg uppercase text-gray-700 mb-2"> Topics </h5><ul><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/topic/investing"><span>Investing</span><span class="text-gray-500 ml-auto">9<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/topic/mathematics"><span>Mathematics</span><span class="text-gray-500 ml-auto">4<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/topic/automation"><span>Automation</span><span class="text-gray-500 ml-auto">2<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li></ul></content></div><div class="border border-dotted"></div><div class="my-2 lg:my-4"><content><h5 class="font-semibold text-lg uppercase text-gray-700 mb-2"> Popular Tags </h5><ul><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/tag/python"><div class="filter-orange-700 h-4 w-4 mr-3 inline-block"><img class="lazyload blur-up" alt="python" data-srcset="https://www.investingsnippets.com/static/python.svg"/></div><span>python</span><span class="text-gray-500 ml-auto">11<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/tag/statistics"><div class="filter-orange-700 h-4 w-4 mr-3 inline-block"><img class="lazyload blur-up" alt="statistics" data-srcset="https://www.investingsnippets.com/static/statistics.svg"/></div><span>statistics</span><span class="text-gray-500 ml-auto">4<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/tag/cryptos"><div class="filter-orange-700 h-4 w-4 mr-3 inline-block"><img class="lazyload blur-up" alt="cryptos" data-srcset="https://www.investingsnippets.com/static/bitcoin.svg"/></div><span>cryptos</span><span class="text-gray-500 ml-auto">1<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li></ul></content></div><div class="border border-dotted"></div><div class="my-2 lg:my-4"><content><h5 class="font-semibold text-lg uppercase text-gray-700 mb-2"> Subscribe </h5><p class="text-gray-600">Receive the next blog article directly to your email!</p><form action="https://tinyletter.com/[object Object]" method="post" target="popupwindow"><input type="email" name="email" id="tlemail" title="Email" required="" placeholder="your email address" class="text-gray-700 bg-gray-100 rounded-t hover:outline-none p-2 w-full mt-4 border outline-none"/><input type="hidden" value="1" name="embed"/><button type="submit" class="px-4 py-2 bg-orange-700 text-gray-200 rounded-b w-full capitalize tracking-wide">Subscribe</button></form><p class="text-gray-600 pt-2 text-xs text-center">or, follow the<!-- --> <a href="/feed.xml" class="inline-block hover:text-blue-700 no-label px-2" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" class="svg-inline--fa fa-rss fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="10px"><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg></a></p></content></div><div class="border border-dotted invisible lg:visible"></div></div></main><footer class="border-t py-12 px-2"><div class="flex pb-4"><div class="flex-auto"><h6><a class="font-semibold text-gray-700 mb-4 no-underline" href="/">Home</a></h6></div><div class="flex-auto"><h6><a class="font-semibold text-gray-700 mb-4 no-underline" href="/terms/general-terms">Terms</a></h6></div></div><div class="text-sm my-2 leading-4 text-gray-600">The content, opinions and conclusions on this website are NOT to be construed as financial advice. I always recommend contacting a licensed independent financial advisor. InvestingSnippets assumes no responsibility for any losses, costs or other consequences that may arise from actions or measures taken based on the content of the website. Investing in financial instruments, securities and mutual funds always involves a risk. The instruments can both increase and decrease in value, also as a result of changes in the exchange rate. It is not certain that you will get back the invested capital. Historical returns are no guarantee of future returns.</div><div class="my-2 text-sm text-gray-600">Copyright ©<!-- --> <!-- -->2021<!-- -->,<!-- --> <!-- -->InvestingSnippets</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"frontmatter":{"title":"Fit Multiple Distributions to Asset Returns!","description":"Why normal distribution is not preferred for stock returns analysis.","date":"March 28, 2021","topic":{"id":"investing","name":"Investing","image":"investing.png","description":"The piggy bank digests a good amount of the savings! There is only one way to get away ... investing. BUT, there is a hidden enemy, Speculation!","color":"bg-green-300"},"tags":[{"id":"python","name":"python","image":"python-header.png","description":"Python is very handy in investing","color":"bg-green-300","icon":"python.svg"}],"author":{"id":"chris","name":"Chris","image":"https://s.gravatar.com/avatar/db809ecfa64d56da4bd9704c8393005a?s=80","description":"Software Engineer, passionate about ..."},"img":"/static/normal-dist-with-hist.png","colab":"https://colab.research.google.com/drive/1p3KbU09vOrplisEzMFEQqGV5Jtuxr3FC?usp=sharing"},"post":{"content":"\nEarlier in [Are Stock Returns Normally Distributed?](post/are-stock-returns-normally-distributed) we went through different ways to validate when asset returns are normally distributed. While we used only one stock to prove that stock returns are not normally distributed, the phenomenon applies to any volatile asset, in general.\n\nThe question though is: Really, which distribution do returns follow?\n\nBelow we load the MSFT stock returns as we did before! \n\n\u003cdetails\u003e\u003csummary\u003ePackage Installation\u003c/summary\u003e\n\u003cp\u003e\n\n```python\n%%capture\n%pip install yahoofinancials\nfrom yahoofinancials import YahooFinancials\nimport pandas as pd\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport dateutil.parser\n```\n\n\u003c/p\u003e\n\u003c/details\u003e\n\n```python\ndef retrieve_stock_data(ticker, start, end):\n    json = YahooFinancials(ticker).get_historical_price_data(start, end, \"daily\")\n    columns=[\"adjclose\"]  # [\"open\",\"close\",\"adjclose\"]\n    df = pd.DataFrame(columns=columns)\n    for row in json[ticker][\"prices\"]:\n        d = dateutil.parser.isoparse(row[\"formatted_date\"])\n        df.loc[d] = [row[\"adjclose\"]] # [row[\"open\"], row[\"close\"], row[\"adjclose\"]]\n    df.index.name = \"date\"\n    return df\n\ndef normal_rets(S):\n    return S.pct_change().dropna()\n\nstock_prices = retrieve_stock_data(\"MSFT\", \"2019-01-01\", \"2020-01-01\")\n\nrets = normal_rets(stock_prices).dropna()\nrets.columns = ['returns']\n```\n\n## Fit all known distributions\n\nInstead of trying to fit the Gaussian Distribution to our data, we will try to fit all the known (scipy.stats implementations) distributions and see which one (or ones) fits the data best.\n\n\n```python\nimport numpy as np\nfrom scipy.stats._continuous_distns import _distn_names\nimport scipy.stats as st\nimport warnings\n\ndef fit_all_distributions(data):\n    \"\"\"\n    Returns: Dict of the density function and the Sum of Squared Errors (SSE)\n    \"\"\"\n    # Get histogram of original data. First, get the x for the pdf\n    # second, get y to calculate the distance between the \n    # distribution and the real data\n    y, x = np.histogram(data, bins='auto', density=True)\n    x = (x + np.roll(x, -1))[:-1] / 2.0\n\n    dist_fit = {}\n\n    # Estimate distribution parameters from data\n    for distname in _distn_names:\n        distribution = getattr(st, distname)\n\n        # Try to fit the distribution\n        try:\n            # Ignore warnings for data that can't be fit\n            with warnings.catch_warnings():\n                warnings.filterwarnings('ignore')\n\n                # fit dist to data\n                params = distribution.fit(data)\n\n                # Calculate fitted PDF and error\n                pdf = distribution.pdf(x, *params)\n                sse = np.sum(np.power(y - pdf, 2.0))\n                dist_fit[distname] = {}\n                dist_fit[distname]['pdf'] = pdf\n                dist_fit[distname]['sse'] = sse\n        except Exception:\n            pass\n\n    return dist_fit\n```\n\n\n```python\ndist_fit = fit_all_distributions(rets.returns)\nlen(dist_fit)\n```\n    99\n\n\n\nWhat? 99? :) Well, It should not be of a surprise that several distributions would fit the data. But the \"fit\" could be really off :) For example an exponential or even a uniform distribution could fit the data, but the squared error (the distance between the actual data points and the respective distribution points) would be really large compared to distributions that approximate the histogram of our data.\n\nLet's get the 15 distributions with the lowest SSE (the ones that best fit the data).\n\n\n```python\ndname_list = []\nsse_list = []\npdf = []\nfor dname in dist_fit:\n  dname_list.append(dname)\n  sse_list.append(dist_fit[dname]['sse'])\n  pdf.append(dist_fit[dname]['pdf'])\n\ndf = pd.DataFrame({'dist': dname_list, 'sse': sse_list, 'pdf':pdf})\ndf = df.sort_values('sse')\ndf_15 = df[:15]\ndf_15\n```\n\n\u003cdiv\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003edist\u003c/th\u003e\n      \u003cth\u003esse\u003c/th\u003e\n      \u003cth\u003epdf\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e52\u003c/th\u003e\n      \u003ctd\u003elaplace\u003c/td\u003e\n      \u003ctd\u003e148.651407\u003c/td\u003e\n      \u003ctd\u003e[1.1152568034938246, 1.787521047421414, 2.8650...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e95\u003c/th\u003e\n      \u003ctd\u003egennorm\u003c/td\u003e\n      \u003ctd\u003e164.078771\u003c/td\u003e\n      \u003ctd\u003e[0.8367820735065007, 1.5154080142470994, 2.686...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e17\u003c/th\u003e\n      \u003ctd\u003edweibull\u003c/td\u003e\n      \u003ctd\u003e176.635717\u003c/td\u003e\n      \u003ctd\u003e[0.8793256263714793, 1.5296378660593237, 2.635...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e16\u003c/th\u003e\n      \u003ctd\u003edgamma\u003c/td\u003e\n      \u003ctd\u003e191.050465\u003c/td\u003e\n      \u003ctd\u003e[0.8552917947109029, 1.4658525793451274, 2.502...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e44\u003c/th\u003e\n      \u003ctd\u003ehypsecant\u003c/td\u003e\n      \u003ctd\u003e213.097016\u003c/td\u003e\n      \u003ctd\u003e[0.7998518705010982, 1.383459240576739, 2.3919...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e48\u003c/th\u003e\n      \u003ctd\u003enorminvgauss\u003c/td\u003e\n      \u003ctd\u003e230.918089\u003c/td\u003e\n      \u003ctd\u003e[0.9381562968673568, 1.5495654573259756, 2.580...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e89\u003c/th\u003e\n      \u003ctd\u003etukeylambda\u003c/td\u003e\n      \u003ctd\u003e232.611350\u003c/td\u003e\n      \u003ctd\u003e[0.7436837695141802, 1.2913003803519416, 2.270...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e51\u003c/th\u003e\n      \u003ctd\u003ejohnsonsu\u003c/td\u003e\n      \u003ctd\u003e241.389639\u003c/td\u003e\n      \u003ctd\u003e[0.9016851129004099, 1.4956683047905153, 2.519...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e69\u003c/th\u003e\n      \u003ctd\u003et\u003c/td\u003e\n      \u003ctd\u003e243.179748\u003c/td\u003e\n      \u003ctd\u003e[0.715121368715189, 1.2350959953532723, 2.1881...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e70\u003c/th\u003e\n      \u003ctd\u003enct\u003c/td\u003e\n      \u003ctd\u003e250.858249\u003c/td\u003e\n      \u003ctd\u003e[0.8688042602613769, 1.4480199008827952, 2.464...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e30\u003c/th\u003e\n      \u003ctd\u003egenlogistic\u003c/td\u003e\n      \u003ctd\u003e260.651315\u003c/td\u003e\n      \u003ctd\u003e[0.8748265286114669, 1.5253897598139983, 2.650...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e56\u003c/th\u003e\n      \u003ctd\u003elogistic\u003c/td\u003e\n      \u003ctd\u003e263.548520\u003c/td\u003e\n      \u003ctd\u003e[0.6451586874653275, 1.2223472162162576, 2.299...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e10\u003c/th\u003e\n      \u003ctd\u003eburr12\u003c/td\u003e\n      \u003ctd\u003e271.252587\u003c/td\u003e\n      \u003ctd\u003e[0.7636589016658705, 1.3949317532979122, 2.529...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e12\u003c/th\u003e\n      \u003ctd\u003ecauchy\u003c/td\u003e\n      \u003ctd\u003e272.502209\u003c/td\u003e\n      \u003ctd\u003e[1.4774507773037833, 1.8876747700442502, 2.491...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e55\u003c/th\u003e\n      \u003ctd\u003elevy_stable\u003c/td\u003e\n      \u003ctd\u003e285.357222\u003c/td\u003e\n      \u003ctd\u003e[0.7622030792115081, 1.252074636445709, 2.2016...\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\nInterestingly `laplace` was the distribution which approximates best the initial data. However, several other distributions are not that far from `laplace` with regards to SSE distances. To showcase that, let's see how the distributions visually correlate with the actual data.\n\n```python\ny, x = np.histogram(rets.returns, bins=19, density=True)\nx = (x + np.roll(x, -1))[:-1] / 2.0\nax = rets.returns.plot(kind='hist', bins=19, figsize=(14,7), density=True, alpha=0.5, \n                       color=list(matplotlib.rcParams['axes.prop_cycle'])[1]['color'])\n\nfor index, row in df_15.iterrows():\n  pd.Series(row.pdf, x).plot(ax=ax, label=row.dist)\nax.set_title(u'All Fitted Distributions')\nax.set_xlabel(u'Returns')\nax.set_ylabel('Frequency')\nplt.legend(loc=\"upper left\")\nax.plot()\n```\n \n![png](fit-distributions-to-asset-returns/fit_distributions_to_asset_returns_8_1.png)\n    \n\nAn interesting observation from the graph above is that all there is almost a concurrence of the distribution legs and tails. On the contrary they do not really agree on the height of the mean bar, but all of them approximate it pretty well.\n\nSo, are we done yet? Shall we, from now on, use `laplace` as the distribution to represent asset returns? \n\nUnfortunately no :(! And the reason why, is that there are several other parameters that can easily interfere with what we expect:\n\n* The number of data points (daily vs. minute vs. monthly)\n* The selected period. (last 3 months will give different result compared to last 6 months or 1 year, or more)\n* The reason we use a distribution (to measure risk? to predict returns? etc.)\n\n## Why T-Student is often used?\n\nYou might have wondered, why so many people use the T-Student distribution when analyzing stock return data!\n\nThe answer to that has to do with the risk that an investor can accept when placing money to a risky asset. There are different ways to measure risk and one of them is the risk estimation based on distributions (model risk). \n\nSay for example, in the MSFT scenario above, that we would like to avoid any daily price drop of more than 2%. And we ask, how confident are we that there will be no drop of more than 2% tomorrow (since we have daily returns)? \n\nThe answer to that question can be derived from the CDF (Cumulative Distribution Function) of a distribution (which is the area under the PDF (Point Distribution Function))\n\nHere is how the normal and student-t PDF looks like for MSFT returns in the period we test. \n\n```python\nax = rets.returns.plot(kind='hist', bins=19, figsize=(14,7), density=True, alpha=0.5, \n                       color=list(matplotlib.rcParams['axes.prop_cycle'])[1]['color'])\n\nstudent_t_pdf = df.loc[df['dist'] == 't'].pdf.values[0]\npd.Series(student_t_pdf, x).plot(ax=ax, label='t')\nnormal_pdf = df.loc[df['dist'] == 'norm'].pdf.values[0]\npd.Series(normal_pdf, x).plot(ax=ax, label='normal')\n\nax.set_title(u'Student-T and Normal Distributions')\nax.set_xlabel(u'Returns')\nax.set_ylabel('Frequency')\nplt.legend(loc=\"upper left\")\nax.plot()\n```\n \n![png](fit-distributions-to-asset-returns/fit_distributions_to_asset_returns_10_1.png)\n    \n\nBack to our question now. How confident are we that tomorrow the price will not drop below 2% (-0.02)? \n\n```python\nnorm_cdf = np.cumsum(normal_pdf)\nt_cdf = np.cumsum(student_t_pdf)\nfig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14,7))\nfig.suptitle('CDF for Normal and T dists')\nax1.plot(x, norm_cdf)\nax2.plot(x, t_cdf)\nplt.show()\n```\n\n![png](fit-distributions-to-asset-returns/fit_distributions_to_asset_returns_12_0.png)\n    \n```python\nnorm_cdf[np.where(x \u003c= -0.02)][-1]\n```\n    9.876651890962592\n\n```python\nt_cdf[np.where(x \u003c= -0.02)][-1]\n```\n    8.086428763077489\n\nAccording to the normal distribution, there is 9.9% probability that the price will drop below 2% while only 8.1% student-t probability. Someone, based on their risk tolerance, would be more confident to place some more money knowing that the estimate is much closer to the reality (well, historical reality)!  \n\nBut, again, it is really up to us to use any distribution we feel comfortable with, based on the data we have, our risk level, and of course (when it comes to statistics) the tools to do our analysis easier.","excerpt":""},"previousPost":{"slug":"a-tradeable-investment-portfolio-as-erc20-token","frontmatter":{"title":"A Tradeable Investment Portfolio as ERC20 Token","description":"Building a simple portfolio on Ethereum blockchain as an ERC20 token.","date":"February 21, 2021","topic":{"id":"automation","name":"Automation","image":"automation.jpg","description":"Spending time to do the same thing over and over again is tedious! Thus, I like to automate as much as possible.","color":"bg-green-300"},"tags":[{"id":"cryptos","name":"cryptos","image":"bitcoin.png","description":"The amazing world of Blockchain opens one more chapter in the Investing.","color":"bg-green-300","icon":"bitcoin.svg"}],"author":{"id":"chris","name":"Chris","image":"https://s.gravatar.com/avatar/db809ecfa64d56da4bd9704c8393005a?s=80","description":"Software Engineer, passionate about ..."},"img":"/static/erc20-exchange.png"},"excerpt":"","content":"\nIn a previous post we discussed how it is possible to create a [simple index fund by combining several tradeable assets](/post/from-portfolio-wealth-index-to-index-fund). We also mentioned that such a portfolio can be traded on the secondary market as a basic ETF. \n\nSuch a scenario is pretty difficult to achieve since special licenses and time consuming actions are needed. However, it is fairly easy to do on the Ethereum blockchain!\n\nThis is what we will try to showcase in this article. We will build a very simple contract that keeps information about a fictional portfolio of other tokens.\n\nIn its extended form, every time someone purchases this token, the amount invested, will be used to purchase the tokens listed in the portfolio based on their weights, and as such, it will follow the development of these tokens (like the index fund we described in the other article).\n\nBelow is a screenshot of the end result. The code is published on [github](https://github.com/investingsnippets/tradeable-investment-portfolio-as-erc20-token).\n\n![png](a-tradeable-investment-portfolio-as-erc20-token/portfolio-token.png)\n\n## Introduction to Ethereum Tokens\n\nI will not go deep into how Ethereum works, since it is a huge topic. We can describe it as a decentralized computer which can execute instructions in a distributed manner. These instructions are simple computer programs (code) that perform a specific job. This program is what we call `An Ethereum Smart Contract`. \n\nThe distributed manner of the contract execution is achieved by the nodes on a blockchain :). That means that the program once might run on a node (server) in USA and the next moment on a node in China. Traditionally, we were used to programs running on a limited number of nodes (e.g. on the cloud), that we managed by a single entity (e.g. cloud provider, company datacenter). However, in the blockchain case, the nodes are just another user terminal (e.g. a server at home, our laptops, etc.).\n\nOn another side, a blockchain solves the well known `double spending` problem (which we will analyze in another post) and due to that, it can be used as an exchange mechanism for digital currencies! Combining these two aspects together, we achieve tradeable contracts (digital assets), which we generally call tokens (they can hold a balance, have a defined supply amount, and can be transferred).\n\nAs an example, imagine a digital currency where you are able to program it with something like. If, the user solves a puzzle on the internet, wins one coin! Or, if the user deposits purchases the coin with some \\$, then these \\$ will be used to purchase other coins and hold them locked in the initial coin, until the owner decides to sell the coin and as a consequence sell the subsequent coins! \n\nNow, the contract creation usually follows some coding principles and is implemented using a programming language. This language is called [Solidity](https://docs.soliditylang.org/en/v0.8.1/) (on Ethereum) and the principles are called standards. ERC20 is such a standard and allows for a digital currency/token creation!\n\nThe tokens can be used in many different ways, which I will describe in a future post. For now we will focus on the creation of digital currency feature.\n\n## The contract\n\nBelow I'm pasting the simplified version of the contract with inlined comments.\n\n```javascript\n// define the solidity compiler version to be used\npragma solidity 0.6.10;\n// additional functionalities for passing around structs  \npragma experimental \"ABIEncoderV2\";\n\n// We use openzeppelin library which provides proper interfaces and\n// solves lot's of boilerplate work we would do otherwise.\nimport { Address } from \"@openzeppelin/contracts/utils/Address.sol\";\nimport { ERC20 } from \"@openzeppelin/contracts/token/ERC20/ERC20.sol\";\nimport { SafeMath } from \"@openzeppelin/contracts/math/SafeMath.sol\";\nimport { SignedSafeMath } from \"@openzeppelin/contracts/math/SignedSafeMath.sol\";\n\n// We define the name of the contract and specify that is an ERC20 token\ncontract PortfolioToken is ERC20 {\n    using Address for address;\n    using SafeMath for uint256;\n    using SignedSafeMath for int256;\n\n    // the user who creates the contract is also the administrator\n    address PortfolioManager;\n\n    // the asset definition\n    struct Asset {\n        uint8 weight; // weight in the Portfolio\n        uint timeStamp; // last updated\n        string name; // name of the asset. For the purposes of the example, since tokens can have the same name\n        string symbol; // symbol of the asset. Also, the symbol of a token can be the same among tokens :(\n    }\n\n    mapping ( address =\u003e Asset ) assets; // this allows to store tokens by their ethereum address\n    address[] public allAssets; // a directory of all the token addresses in the fund\n    mapping(address =\u003e bool) public isResource; // for validation purposes\n\n    // the initial price of the token\n    int256 private strikePrice;\n\n    // the contsrucor of the token will be called when deploying the contract\n    constructor(\n        int256 _strikePrice,\n        string memory _name,\n        string memory _symbol\n    )\n        public\n        ERC20(_name, _symbol)\n    {\n        PortfolioManager = msg.sender;\n        strikePrice = _strikePrice;\n    }\n\n    modifier onlyManager() {\n        _validateOnlyManager();\n        _;\n    }\n\n    function mint(address _account, uint256 _quantity) public {\n        _mint(_account, _quantity);\n    }\n\n    // the main method used to add an asset to the portfolio\n    function addAsset(address _assetAddress, uint8 _weight, string memory _name, string memory _symbol) external onlyManager {\n        require(!isResource[_assetAddress], \"Asset already exists\"); // not adding true/false val in struct to save gas\n        assets[_assetAddress].weight = _weight;\n        assets[_assetAddress].name = _name;\n        assets[_assetAddress].symbol = _symbol;\n        assets[_assetAddress].timeStamp = block.timestamp;\n        isResource[_assetAddress] = true;\n        allAssets.push(_assetAddress);\n    }\n\n    // edits an asset's weight\n    function editAsset(address _assetAddress, uint8 _weight) external onlyManager {\n        assets[_assetAddress].weight = _weight;\n        assets[_assetAddress].timeStamp = block.timestamp;\n    }\n\n    // removes an asset from the portfolio\n    function removeAsset(address _assetAddress) external onlyManager {\n        delete assets[_assetAddress];\n        // allAssets = allAssets.remove(_assetAddress);\n        isResource[_assetAddress] = false;\n    }\n\n    // returns a list of assets in the portfolio\n    function getAssets() external view returns(address[] memory) {\n        return allAssets;\n    }\n\n    // return the info of an asset by passing the address of it\n    function getAssetInfo(address _assetAddress) external view returns(string memory name, string memory symbol, uint8 weight, uint timeStamp) {\n        return (assets[_assetAddress].name, assets[_assetAddress].symbol, assets[_assetAddress].weight, assets[_assetAddress].timeStamp);\n    } \n\n    function _validateOnlyManager() internal view {\n        require(msg.sender == PortfolioManager, \"Only manager has access\");\n    }\n}\n```\n\n## How to try it out\n\n\u003e Note: Make sure that MetaMask is either disabled, or configured to use the local blockchain. OR, use browser in incognito mode. Be extra careful! (you have been warned ;))\n\nFor this project I have used:\n\n* ganache, which provides a local Ethereum blockchain.\n* truffle, which provides tooling to compile, test and deploy contracts\n* drizzle, which implements client side interaction with the contract (through web3.js)\n* react, for building a simple web application to be able to graphically interact with the contract\n\nTo run the example, clone the [github repo](https://github.com/investingsnippets/tradeable-investment-portfolio-as-erc20-token) and make sure that docker is installed on your machine.\n\nThen, use the command\n\n```bash\ndocker-compose run -p \"3000:3000\" -p \"8545:8545\" --rm develop\n```\n\nwhich starts everything needed in docker and exposes the web app on port 3000!\n\nJust visit `http://localhost:3000/` on your browser and experiment with the app.\n"},"nextPost":{"slug":"modern-portfolio-theory","frontmatter":{"title":"Modern Portfolio Theory - Part 1","description":"A Nobel Price winning theory that has shaped Investing.","date":"April 2, 2021","topic":{"id":"investing","name":"Investing","image":"investing.png","description":"The piggy bank digests a good amount of the savings! There is only one way to get away ... investing. BUT, there is a hidden enemy, Speculation!","color":"bg-green-300"},"tags":[{"id":"python","name":"python","image":"python-header.png","description":"Python is very handy in investing","color":"bg-green-300","icon":"python.svg"}],"author":{"id":"chris","name":"Chris","image":"https://s.gravatar.com/avatar/db809ecfa64d56da4bd9704c8393005a?s=80","description":"Software Engineer, passionate about ..."},"img":"/static/nobel-price.jpg","colab":"https://colab.research.google.com/drive/1U6dR3xx-g4NWXl-5NKtGlMZVIkSJcJEz?usp=sharing"},"excerpt":"","content":"\nIn a previous post about [Return \u0026 Volatility of a Multi-Asset Portfolio](/post/portfolio-expected-return-and-risk) we saw how the correlation of the prices of two assets was a key part to achieving lower volatility than the volatility of the assets' individually. We built a visual proof with just two random assets.\n\nThis \"visual proof\" is called Efficient Frontier\n\n![jpg](https://upload.wikimedia.org/wikipedia/commons/e/e1/Markowitz_frontier.jpg)\n\nwhich is part of Modern portfolio theory (MPT) and according to [wikipedia](https://en.wikipedia.org/wiki/Modern_portfolio_theory)\n\n\u003e Modern portfolio theory (MPT), or mean-variance analysis, is a mathematical framework for assembling a portfolio of assets such that the expected return is maximized for a given level of risk. It is a formalization and extension of diversification in investing, the idea that owning different kinds of financial assets is less risky than owning only one type. Its key insight is that an asset's risk and return should not be assessed by itself, but by how it contributes to a portfolio's overall risk and return. It uses the variance of asset prices as a proxy for risk.\n\n\u003e Economist Harry Markowitz introduced MPT in a 1952 essay, for which he was later awarded a Nobel Memorial Prize in Economic Sciences; see [Markowitz model](https://en.wikipedia.org/wiki/Markowitz_model).\n\nThe \"two asset\" Efficient Frontier we built in the previous post was done through carefully picking the asset weights and printing the mean-variance graph. Then, we were able to find on the graph which pair of wights was responsible for the minimum volatility amount.\n\nWe will do the same today but instead of using the Efficient Frontier for that, we will use some optimizers provided by `numpy`. \n\n## Data Collection\n\nAs always, we set the ground work needed to fetch some stock data.\n\n\u003cdetails\u003e\u003csummary\u003ePackage Installation\u003c/summary\u003e\n\u003cp\u003e\n\n```python\n%%capture\n%pip install yahoofinancials\nfrom yahoofinancials import YahooFinancials\nimport pandas as pd\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport dateutil.parser\nimport numpy as np\n```\n\n\u003c/p\u003e\n\u003c/details\u003e\n\n```python\nSTOCK_SYMBOLS = ['MSFT', 'APT']\n\ndef retrieve_stock_data(symbol, start, end):\n    '''\n    Fetches daily stock prices from Yahoo Finance\n    '''\n    json = YahooFinancials(symbol).get_historical_price_data(start, end, \"daily\")\n    df = pd.DataFrame(columns=[\"adjclose\"])\n    for row in json[symbol][\"prices\"]:\n        d = dateutil.parser.isoparse(row[\"formatted_date\"])\n        df.loc[d] = [row[\"adjclose\"]]\n    df.index.name = \"date\"\n    return df\n\ndef normal_rets(S):\n    '''Returns the returns. (price_today - price_yesterday)/price_yesterday'''\n    return S.pct_change().dropna()\n\ndef annualize_rets(r, periods_per_year):\n    compounded_growth = (1+r).prod()\n    n_periods = r.shape[0]\n    return compounded_growth**(periods_per_year/n_periods)-1\n\ndef portfolio_return(weights, returns):\n    return weights.T @ returns\n\ndef portfolio_volatility(weights, covariance_matrix):\n    return (weights.T @ covariance_matrix @ weights)**0.5\n\ndef generate_returns_dataframe(symbols_list, d_from=\"2020-01-01\", d_to=\"2021-01-01\"):\n    '''\n    Generates a DataFrame with daily returns for a list of Symbols.\n    '''\n    returns = pd.DataFrame()\n    for symbol in symbols_list:\n        stock_prices = retrieve_stock_data(symbol, d_from, d_to)\n        rets = normal_rets(stock_prices).dropna()\n        rets.columns = [symbol]\n\n        if returns.empty:\n            returns = rets\n        else:\n            returns = returns.merge(rets, left_index=True, right_index=True)\n    return returns\n```\n\n\n```python\nreturns = generate_returns_dataframe(STOCK_SYMBOLS)\nreturns.head(5)\n```\n\n\u003cdiv\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eMSFT\u003c/th\u003e\n      \u003cth\u003eAPT\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003edate\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2020-01-03\u003c/th\u003e\n      \u003ctd\u003e-0.012452\u003c/td\u003e\n      \u003ctd\u003e0.005780\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2020-01-06\u003c/th\u003e\n      \u003ctd\u003e0.002585\u003c/td\u003e\n      \u003ctd\u003e0.008621\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2020-01-07\u003c/th\u003e\n      \u003ctd\u003e-0.009118\u003c/td\u003e\n      \u003ctd\u003e0.000000\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2020-01-08\u003c/th\u003e\n      \u003ctd\u003e0.015928\u003c/td\u003e\n      \u003ctd\u003e-0.002849\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2020-01-09\u003c/th\u003e\n      \u003ctd\u003e0.012493\u003c/td\u003e\n      \u003ctd\u003e0.000000\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\n\n## Volatility Minimization\n\nThe data we collected above is the same as [Return \u0026 Volatility of a Multi-Asset Portfolio](/post/portfolio-expected-return-and-risk), and the purpose is to find the weights that minimize the volatility of the portfolio. As we saw from the graph in the previous article, the weights should be somewhere close to [0.89, 0.11].\n\nFor example, given weights [0.5, 0.5], the portfolio return is:\n\n\n```python\nportfolio_return(np.array([0.5, 0.5]), annualize_rets(returns, 252)) - 1\n```\n    0.3109859252509841\n\n\nTo avoid a brute-force approach with trying different weights and getting the ones that give the minimum volatility, we can use algorithms that do this for us. Algorithms like [Sequential quadratic programming](https://en.wikipedia.org/wiki/Sequential_quadratic_programming) which based on the amount of constraints performs different levels of differentiations with purpose to minimize a cost function. In general, the objective function which in our case is the Efficient Frontier, has a point where the tangent either gets 0 or 1. In our case the tangent should be 1. The algorithm iteratively walks through the objective function, finds the tangent, and applies the constraints. Of course, like any cost function optimization in Machine Learning the accuracy is not always 100%! The algorithm may get stuck in local minima and not be able to find the best result. However, in the case of Efficient Frontier, the objective function has only one minimum and thus makes it easier to find.\n\nLet's apply the algorithm to our data. The only constraints we provide for now is that the sum of the weights must be equal to 1.\n\n\n```python\nfrom scipy.optimize import minimize\nn = len(STOCK_SYMBOLS)\ncov = returns.cov()\nweights_sum_to_1 = {\n    'type': 'eq',\n    'fun': lambda weights: np.sum(weights) - 1\n}\nresult = minimize(portfolio_volatility, np.repeat(0, n), args=(cov, ),\n                  method=\"SLSQP\", options={'disp': False},\n                  constraints=(weights_sum_to_1), bounds=((0.0, 1.0),)*n)\nresult.x\n```\n    array([0.89906844, 0.10093156])\n\n\nThe portfolio that produces the minimum risk for an investor is called `Global Minimum Variance (GMV)` portfolio and lies at the far left of the Efficient Frontier.\n\nIn a next article we will go one step further in the Efficient Frontier analysis and try to find other points in the graph that are of interest.\n\nStay tuned!"}},"tags":[{"id":"python","name":"python","image":"python-header.png","description":"Python is very handy in investing","color":"bg-green-300","icon":"python.svg","slug":"python","count":11},{"id":"statistics","name":"statistics","image":"statistics.jpg","description":"Statistics is the discipline that concerns the collection, organization, analysis, interpretation and presentation of data. - Wikipedia","color":"bg-green-300","icon":"statistics.svg","slug":"statistics","count":4},{"id":"cryptos","name":"cryptos","image":"bitcoin.png","description":"The amazing world of Blockchain opens one more chapter in the Investing.","color":"bg-green-300","icon":"bitcoin.svg","slug":"cryptos","count":1}],"sortedTopics":[{"id":"investing","name":"Investing","image":"investing.png","description":"The piggy bank digests a good amount of the savings! There is only one way to get away ... investing. BUT, there is a hidden enemy, Speculation!","color":"bg-green-300","slug":"investing","count":9},{"id":"mathematics","name":"Mathematics","image":"mathematics.png","description":"Investing, as part of the Science of Finance, is subject to the lows of Mathematics!","color":"bg-green-300","slug":"mathematics","count":4},{"id":"automation","name":"Automation","image":"automation.jpg","description":"Spending time to do the same thing over and over again is tedious! Thus, I like to automate as much as possible.","color":"bg-green-300","slug":"automation","count":2}],"allTopics":[{"id":"mathematics","name":"Mathematics","image":"mathematics.png","description":"Investing, as part of the Science of Finance, is subject to the lows of Mathematics!","color":"bg-green-300"},{"id":"automation","name":"Automation","image":"automation.jpg","description":"Spending time to do the same thing over and over again is tedious! Thus, I like to automate as much as possible.","color":"bg-green-300"},{"id":"investing","name":"Investing","image":"investing.png","description":"The piggy bank digests a good amount of the savings! There is only one way to get away ... investing. BUT, there is a hidden enemy, Speculation!","color":"bg-green-300"}],"slug":"fit-distributions-to-asset-returns"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"fit-distributions-to-asset-returns"},"buildId":"Cpr1H8DEYWxtnmx4hcz7a","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-6d6446214035a37ee7d9.js"></script><script src="/_next/static/chunks/main-9b805fa25f3c727dff23.js" async=""></script><script src="/_next/static/chunks/webpack-eb080e3f091731f228fb.js" async=""></script><script src="/_next/static/chunks/framework.1d36bc031662b4dc4c28.js" async=""></script><script src="/_next/static/chunks/aafb98ef.d6f2610c02ca1f2f8023.js" async=""></script><script src="/_next/static/chunks/commons.8953387921da877f7077.js" async=""></script><script src="/_next/static/chunks/c993a675fc23e2c5b16b0cdfa51e09fd2f5f8f80.7eda6f7f6f606b39097e.js" async=""></script><script src="/_next/static/chunks/pages/_app-8d389892d8851416e9e3.js" async=""></script><script src="/_next/static/chunks/cb1608f2.374587486deb2a784e19.js" async=""></script><script src="/_next/static/chunks/a9a7754c.d9f31489d713bac24f81.js" async=""></script><script src="/_next/static/chunks/60273576.45a211ac3b19a5bdcfc0.js" async=""></script><script src="/_next/static/chunks/28b78d933298d505941537c6c1190f6a19d63af1.41b7ccb1b9a7b85862b6.js" async=""></script><script src="/_next/static/chunks/f485e41bcb118a628b46c21556cf62824a9a6265.b5d54d4427b3ca2aa455.js" async=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-c295bfa18e28c0faf5ff.js" async=""></script><script src="/_next/static/Cpr1H8DEYWxtnmx4hcz7a/_buildManifest.js" async=""></script><script src="/_next/static/Cpr1H8DEYWxtnmx4hcz7a/_ssgManifest.js" async=""></script></body></html>