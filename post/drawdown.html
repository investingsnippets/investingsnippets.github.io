<!DOCTYPE html><html lang="en-US"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-180222243-1"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-180222243-1', {
              page_path: window.location.pathname,
            });
          </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Drawdown</title><meta name="description" content="A great measure of risk indicator."/><meta property="og:type" content="website"/><meta name="og:title" property="og:title" content="Drawdown"/><meta name="og:description" property="og:description" content="A great measure of risk indicator."/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Drawdown"/><meta name="twitter:description" content="A great measure of risk indicator."/><meta name="twitter:creator" content="investingsnipts"/><link rel="icon" type="image/png" href="/static/favicon.ico"/><link rel="apple-touch-icon" href="/static/favicon.ico"/><meta name="next-head-count" content="13"/><link rel="preload" href="/_next/static/css/2d2f87205aa6ef8b4f4a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2d2f87205aa6ef8b4f4a.css" data-n-g=""/><link rel="preload" href="/_next/static/css/276cb3c5109fbc96253b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/276cb3c5109fbc96253b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/ac25f9c66a4be8cd3ac3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ac25f9c66a4be8cd3ac3.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-9b805fa25f3c727dff23.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-eb080e3f091731f228fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1d36bc031662b4dc4c28.js" as="script"/><link rel="preload" href="/_next/static/chunks/aafb98ef.d6f2610c02ca1f2f8023.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.8953387921da877f7077.js" as="script"/><link rel="preload" href="/_next/static/chunks/c993a675fc23e2c5b16b0cdfa51e09fd2f5f8f80.7eda6f7f6f606b39097e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-8d389892d8851416e9e3.js" as="script"/><link rel="preload" href="/_next/static/chunks/cb1608f2.374587486deb2a784e19.js" as="script"/><link rel="preload" href="/_next/static/chunks/a9a7754c.d9f31489d713bac24f81.js" as="script"/><link rel="preload" href="/_next/static/chunks/60273576.45a211ac3b19a5bdcfc0.js" as="script"/><link rel="preload" href="/_next/static/chunks/28b78d933298d505941537c6c1190f6a19d63af1.41b7ccb1b9a7b85862b6.js" as="script"/><link rel="preload" href="/_next/static/chunks/f485e41bcb118a628b46c21556cf62824a9a6265.b5d54d4427b3ca2aa455.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/post/%5Bslug%5D-97291d7a14d13b3eb33a.js" as="script"/></head><body><div id="__next"><div class="overflow-hidden items-center justify-center bg-gray-100 max-w-screen-xl mx-auto"><header class="container"><nav class="relative select-none bg-grey lg:flex lg:items-stretch w-full pt-4"><div class="flex flex-no-shrink items-stretch h-12"><a class="flex-no-grow flex-no-shrink relative p-2 leading-normal text-3xl lg:text-5xl no-underline font-semibold flex items-center" href="/">InvestingSnippets</a><button id="hamburgerMenu" type="button" class="block lg:hidden cursor-pointer ml-auto relative w-12 h-12 p-4"><svg id="hamburgerBtn" class="visible fill-current text-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg><svg id="hamburgerClose" class="hidden fill-current text-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"></path></svg></button></div><div class="lg:flex lg:items-stretch lg:flex-no-shrink lg:flex-grow hidden" id="mobileMenu"><div class="lg:flex lg:items-stretch lg:justify-end ml-auto"><a class="flex-no-grow flex-no-shrink relative py-2 px-4 leading-normal font-semibold text-gray-700 no-underline flex items-center hover:bg-grey-dark" href="/topic/mathematics"><span>Mathematics</span></a><a class="flex-no-grow flex-no-shrink relative py-2 px-4 leading-normal font-semibold text-gray-700 no-underline flex items-center hover:bg-grey-dark" href="/topic/automation"><span>Automation</span></a><a class="flex-no-grow flex-no-shrink relative py-2 px-4 leading-normal font-semibold text-gray-700 no-underline flex items-center hover:bg-grey-dark" href="/topic/investing"><span>Investing</span></a></div></div></nav></header><main class="block lg:flex lg:space-x-2 px-2 lg:p-0 mt-10 mb-10"><div class="w-full lg:w-2/3 px-2"><article><header class="mb-8"><p class="text-sm mb-2"><a class="" href="/">Home</a> &gt; <a class="" href="/topic/investing">Investing</a> &gt; </p><h1 class="mb-2 text-3xl lg:text-4xl leading-none font-display font-semibold">Drawdown</h1><p class="text-sm mb-2">February 18, 2021<!-- --> <!-- -->by<!-- --> <!-- -->Chris</p><div class="flex justify-end mt-2 mr-5"><a class="text-gray-600" href="/tag/python"><img class="filter-orange-700 h-4 w-4 m-1 inline-block" alt="python" src="https://www.investingsnippets.com/static/python.svg" data-srcset="https://www.investingsnippets.com/static/python.svg"/>python</a></div><div class="flex justify-end mt-2 mr-5"><a target="_blank" rel="noopener noreferrer" href="https://colab.research.google.com/drive/1LFUprI0yMOLPDK4yqgpRAi5sPrGrDhTi?usp=sharing"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></div></header><div class="mb-4 prose-lg max-w-none markdown-styles_reactMarkDown__3jmlK"><p>In a previous <a href="/post/from-portfolio-wealth-index-to-index-fund">post</a> we talked about the wealth index of an asset as well as a portfolio of assets. The idea of the <code>wealth index</code> is very powerful because it represents the cumulative profit of an asset (since it depends on the price returns).</p>
<p>Now, if we have invested 100$ on an asset and we were asked to find the maximum loss, when did that happen and for how long did it last? We need to walk through our wealth index and find all the deeps, then see which one was the largest, when it did happen and when it finally recovered to the previous peak value.</p>
<p>We employ a well known measure of risk in Investing, called <strong>Drawdown</strong>.</p>
<h2>Computation and Plotting of the Drawdown</h2>
<p>First the ground code that allows us to fetch stock historical data.</p>
<details><summary>Package Installation</summary>
<p>
</p><pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#a9b7c6">%</span><span>pip install yahoofinancials
</span><span></span><span class="token" style="color:#cc7832">from</span><span> yahoofinancials </span><span class="token" style="color:#cc7832">import</span><span> YahooFinancials
</span><span></span><span class="token" style="color:#cc7832">import</span><span> pandas </span><span class="token" style="color:#cc7832">as</span><span> pd
</span><span></span><span class="token" style="color:#cc7832">import</span><span> matplotlib
</span><span></span><span class="token" style="color:#cc7832">import</span><span> matplotlib</span><span class="token" style="color:#a9b7c6">.</span><span>pyplot </span><span class="token" style="color:#cc7832">as</span><span> plt
</span><span></span><span class="token" style="color:#cc7832">import</span><span> seaborn </span><span class="token" style="color:#cc7832">as</span><span> sns
</span><span></span><span class="token" style="color:#cc7832">import</span><span> dateutil</span><span class="token" style="color:#a9b7c6">.</span><span>parser
</span><span></span><span class="token" style="color:#cc7832">import</span><span> numpy </span><span class="token" style="color:#cc7832">as</span><span> np</span></code></div></pre>
<p></p>
</details>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">retrieve_stock_data</span><span class="token" style="color:#a9b7c6">(</span><span>ticker</span><span class="token" style="color:#a9b7c6">,</span><span> start</span><span class="token" style="color:#a9b7c6">,</span><span> end</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    json </span><span class="token" style="color:#a9b7c6">=</span><span> YahooFinancials</span><span class="token" style="color:#a9b7c6">(</span><span>ticker</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>get_historical_price_data</span><span class="token" style="color:#a9b7c6">(</span><span>start</span><span class="token" style="color:#a9b7c6">,</span><span> end</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&quot;daily&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>    columns</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;adjclose&quot;</span><span class="token" style="color:#a9b7c6">]</span><span>  </span><span class="token" style="color:#808080"># [&quot;open&quot;,&quot;close&quot;,&quot;adjclose&quot;]</span><span>
</span><span>    df </span><span class="token" style="color:#a9b7c6">=</span><span> pd</span><span class="token" style="color:#a9b7c6">.</span><span>DataFrame</span><span class="token" style="color:#a9b7c6">(</span><span>columns</span><span class="token" style="color:#a9b7c6">=</span><span>columns</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">for</span><span> row </span><span class="token" style="color:#cc7832">in</span><span> json</span><span class="token" style="color:#a9b7c6">[</span><span>ticker</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;prices&quot;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>        d </span><span class="token" style="color:#a9b7c6">=</span><span> dateutil</span><span class="token" style="color:#a9b7c6">.</span><span>parser</span><span class="token" style="color:#a9b7c6">.</span><span>isoparse</span><span class="token" style="color:#a9b7c6">(</span><span>row</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;formatted_date&quot;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>        df</span><span class="token" style="color:#a9b7c6">.</span><span>loc</span><span class="token" style="color:#a9b7c6">[</span><span>d</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>row</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;adjclose&quot;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#808080"># [row[&quot;open&quot;], row[&quot;close&quot;], row[&quot;adjclose&quot;]]</span><span>
</span><span>    df</span><span class="token" style="color:#a9b7c6">.</span><span>index</span><span class="token" style="color:#a9b7c6">.</span><span>name </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6a8759">&quot;date&quot;</span><span>
</span><span>    df</span><span class="token" style="color:#a9b7c6">.</span><span>columns </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#a9b7c6">[</span><span>ticker</span><span class="token" style="color:#a9b7c6">]</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> df
</span>
<span></span><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">normal_rets</span><span class="token" style="color:#a9b7c6">(</span><span>S</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>    </span><span class="token" style="color:#cc7832">return</span><span> S</span><span class="token" style="color:#a9b7c6">.</span><span>pct_change</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>dropna</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<p>I&#x27;ll randomly pick Apple&#x27;s (AAPL) stock for this analysis.</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>apple_stock_prices </span><span class="token" style="color:#a9b7c6">=</span><span> retrieve_stock_data</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;AAPL&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&quot;1990-03-14&quot;</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#6a8759">&quot;2021-02-17&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>apple_rets </span><span class="token" style="color:#a9b7c6">=</span><span> normal_rets</span><span class="token" style="color:#a9b7c6">(</span><span>apple_stock_prices</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>dropna</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>fig</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#a9b7c6">(</span><span>ax1</span><span class="token" style="color:#a9b7c6">,</span><span> ax2</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> plt</span><span class="token" style="color:#a9b7c6">.</span><span>subplots</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">2</span><span class="token" style="color:#a9b7c6">,</span><span> sharex</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#cc7832">True</span><span class="token" style="color:#a9b7c6">,</span><span> figsize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">14</span><span class="token" style="color:#a9b7c6">,</span><span class="token" style="color:#6897bb">7</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>fig</span><span class="token" style="color:#a9b7c6">.</span><span>suptitle</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&quot;Apple&#x27;s Price &amp; Returns&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>apple_stock_prices</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>ax</span><span class="token" style="color:#a9b7c6">=</span><span>ax1</span><span class="token" style="color:#a9b7c6">,</span><span> label</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;Price&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>apple_rets</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>ax</span><span class="token" style="color:#a9b7c6">=</span><span>ax2</span><span class="token" style="color:#a9b7c6">,</span><span> label</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&#x27;Returns&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>plt</span><span class="token" style="color:#a9b7c6">.</span><span>legend</span><span class="token" style="color:#a9b7c6">(</span><span>loc</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;upper left&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>plt</span><span class="token" style="color:#a9b7c6">.</span><span>show</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<p><div class="w-full mx-auto flex justify-center"><img class="lazyload blur-up" alt="png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAAAklEQVR4AewaftIAAACsSURBVDXBTQ7BQBgG4Pcb01YNqo0z+AmxkOgtuucYbmVv1cRaWHALCZuaYKhiPiQ8Dy1X69Gg3+s4joOvNE3dMAwRx3GBH23yQnbbrYlSaoqfJEnwZ5lxf1qUPU/L7Kg3+nyZEQkIInwxGMxAPQj4djkRW2tkpVob7vPS+PG00NcHmlUPrhRwHYFTQSiVG5DEWhY3M98uFgd8MAg7QciyTERR9FJKwRgD3/fzNye/ROjJ4LtuAAAAAElFTkSuQmCC" data-srcset="/_next/static/images/drawdown_3_0-72e870f2303e42b214479a0e373e4cc1.png"/></div></p>
<p>Say now that we invested 100$ late 2016. Let&#x27;s build the wealth index like we did in this <a href="/post/from-portfolio-wealth-index-to-index-fund">post</a>, and find the peaks of the wealth index. That is, the highest generated wealth prices before a deep.</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>wealth_index </span><span class="token" style="color:#a9b7c6">=</span><span> </span><span class="token" style="color:#6897bb">100</span><span class="token" style="color:#a9b7c6">*</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">+</span><span>apple_rets</span><span class="token" style="color:#a9b7c6">.</span><span>AAPL</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&quot;12-2016&quot;</span><span class="token" style="color:#a9b7c6">:</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>cumprod</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>peaks </span><span class="token" style="color:#a9b7c6">=</span><span> wealth_index</span><span class="token" style="color:#a9b7c6">.</span><span>cummax</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>ax </span><span class="token" style="color:#a9b7c6">=</span><span> wealth_index</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>figsize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">14</span><span class="token" style="color:#a9b7c6">,</span><span class="token" style="color:#6897bb">7</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span> label</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;W-Index&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>peaks</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>ax</span><span class="token" style="color:#a9b7c6">=</span><span>ax</span><span class="token" style="color:#a9b7c6">,</span><span> label</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;Peaks&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>plt</span><span class="token" style="color:#a9b7c6">.</span><span>legend</span><span class="token" style="color:#a9b7c6">(</span><span>loc</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;upper left&quot;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>plt</span><span class="token" style="color:#a9b7c6">.</span><span>show</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<p><div class="w-full mx-auto flex justify-center"><img class="lazyload blur-up" alt="png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAAAklEQVR4AewaftIAAAB4SURBVHXBUQqCUBBA0Ts+BdGx+gqEdtF22kFupY0mRNTDLJ03+dFnniN9f72oNqeiKPjH5onn63PL61qbsiz3rHgMIxutQs4KT4l7HNhqhbuTs7B5wlLCHSwlQAghY9coImBmSNedj+5+EMkEcBYxxqCqxk/btu8vEXUv88EZwLIAAAAASUVORK5CYII=" data-srcset="/_next/static/images/drawdown_5_0-97430902f9a7bfceb1dc2d4968a07bb3.png"/></div></p>
<p>Do you see these nice lagoons? Well, we wouldn&#x27;t want them to be deep and long in duration, cause that is when our investment looses value and we have to wait until it recovers!</p>
<p>So, moving forward we want to find which lagoon was the deepest, how deep? and how long did it take to move back to the previous peak.</p>
<p>First things first, we have to measure at any given point what is the difference between the peak and the wealth index. For example, the peak at a given point is 220$ and the index is 150$. That means that the index is 70$ below the peak. Since our target point is 220$ and we have lost 70$, we can say that we we are <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mfrac><mn>70</mn><mn>220</mn></mfrac><mo>=</mo><mn>31.8</mn></mrow><annotation encoding="application/x-tex">-\frac{70}{220}=31.8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em"></span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">220</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">70</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">31.8</span></span></span></span></span>% below the target.</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>drawdown </span><span class="token" style="color:#a9b7c6">=</span><span>  </span><span class="token" style="color:#a9b7c6">(</span><span>wealth_index </span><span class="token" style="color:#a9b7c6">-</span><span> peaks</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">/</span><span>peaks
</span><span>drawdown</span><span class="token" style="color:#a9b7c6">.</span><span>plot</span><span class="token" style="color:#a9b7c6">(</span><span>figsize</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6897bb">14</span><span class="token" style="color:#a9b7c6">,</span><span class="token" style="color:#6897bb">7</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span> title</span><span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">&quot;Drawdown&quot;</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<p><div class="w-full mx-auto flex justify-center"><img class="lazyload blur-up" alt="png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAAAklEQVR4AewaftIAAACcSURBVE3BywqCYBAG0G/G8VqmthAMgrbhoqfoIVr2Fr5uYcsWaml5mT8Cg86hsrydZBmfq3YAM6G8XmgTubLOtkPbT5jUwGHUEgT+LomCYxRM6IYJ2WEPBuHxHuE7DDUGvtBdMPNsC55toR8Vz35EsnBQdQNWrg0hAzbG4J8jDCaCMCH2bbjC+KKiKHJVzVUVP3XT8CoMFbM0TV8fa2U33s914/AAAAAASUVORK5CYII=" data-srcset="/_next/static/images/drawdown_7_1-05eae039ce2cbfb4611dcfc0182e8714.png"/></div></p>
<p>The diagram above is what we call a <strong>Drawdown</strong> of an asset and it doesn&#x27;t really have to do with any initial investment. Drawdown is a very nice indicator of risk since it is more realistic when compared to other risk indicators that involve standard deviations (Since returns deviate from normality as we proved in <a href="/post/are-stock-returns-normally-distributed">Are Stock Returns Normally Distributed</a>)</p>
<h2>Useful insights from the Drawdown</h2>
<p>We are now ready to find the largest drawdown and the date that occurred.</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>drawdown</span><span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#e8bf6a">min</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span> drawdown</span><span class="token" style="color:#a9b7c6">.</span><span>idxmin</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<pre><code>(-0.38515910000506054, Timestamp(&#x27;2019-01-03 00:00:00&#x27;))
</code></pre>
<p>We see that on the 3rd of January 2019 our investment was loosing 38.5% of its value!</p>
<p>One step further, we will try to find how long the lagoons lasted and find the longest one and an average of their durations.</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">def</span><span> </span><span class="token" style="color:#ffc66d">compute_drawdown_lagoons_durations</span><span class="token" style="color:#a9b7c6">(</span><span>drawdown</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span><span>
</span><span>  </span><span class="token" style="color:#808080"># find all the locations where the drawdown == 0</span><span>
</span><span>  zero_locations </span><span class="token" style="color:#a9b7c6">=</span><span> np</span><span class="token" style="color:#a9b7c6">.</span><span>unique</span><span class="token" style="color:#a9b7c6">(</span><span>np</span><span class="token" style="color:#a9b7c6">.</span><span>r_</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#a9b7c6">(</span><span>drawdown </span><span class="token" style="color:#a9b7c6">==</span><span> </span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span>values</span><span class="token" style="color:#a9b7c6">.</span><span>nonzero</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">,</span><span> </span><span class="token" style="color:#e8bf6a">len</span><span class="token" style="color:#a9b7c6">(</span><span>drawdown</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">-</span><span> </span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  </span><span class="token" style="color:#808080"># also assign the dates so we know when things were not sinking</span><span>
</span><span>  zero_locations_series </span><span class="token" style="color:#a9b7c6">=</span><span> pd</span><span class="token" style="color:#a9b7c6">.</span><span>Series</span><span class="token" style="color:#a9b7c6">(</span><span>zero_locations</span><span class="token" style="color:#a9b7c6">,</span><span> index</span><span class="token" style="color:#a9b7c6">=</span><span>drawdown</span><span class="token" style="color:#a9b7c6">.</span><span>index</span><span class="token" style="color:#a9b7c6">[</span><span>zero_locations</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  </span><span class="token" style="color:#808080"># do a shift to show what is the last and previous non zero dates</span><span>
</span><span>  df </span><span class="token" style="color:#a9b7c6">=</span><span> zero_locations_series</span><span class="token" style="color:#a9b7c6">.</span><span>to_frame</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">&#x27;zero_loc&#x27;</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  df</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;prev_zloc&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> zero_locations_series</span><span class="token" style="color:#a9b7c6">.</span><span>shift</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  </span><span class="token" style="color:#808080"># keep only the dates where the difference is more than 1</span><span>
</span><span>  </span><span class="token" style="color:#808080"># that denotes the lagoons</span><span>
</span><span>  df </span><span class="token" style="color:#a9b7c6">=</span><span> df</span><span class="token" style="color:#a9b7c6">[</span><span>df</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;zero_loc&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">-</span><span> df</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;prev_zloc&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">&gt;</span><span> </span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">.</span><span>astype</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#e8bf6a">int</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  df</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;duration&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span> </span><span class="token" style="color:#a9b7c6">=</span><span> df</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;zero_loc&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#e8bf6a">map</span><span class="token" style="color:#a9b7c6">(</span><span>drawdown</span><span class="token" style="color:#a9b7c6">.</span><span>index</span><span class="token" style="color:#a9b7c6">.</span><span>__getitem__</span><span class="token" style="color:#a9b7c6">)</span><span> </span><span class="token" style="color:#a9b7c6">-</span><span> df</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;prev_zloc&#x27;</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#e8bf6a">map</span><span class="token" style="color:#a9b7c6">(</span><span>drawdown</span><span class="token" style="color:#a9b7c6">.</span><span>index</span><span class="token" style="color:#a9b7c6">.</span><span>__getitem__</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  df </span><span class="token" style="color:#a9b7c6">=</span><span> df</span><span class="token" style="color:#a9b7c6">.</span><span>reindex</span><span class="token" style="color:#a9b7c6">(</span><span>drawdown</span><span class="token" style="color:#a9b7c6">.</span><span>index</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  df </span><span class="token" style="color:#a9b7c6">=</span><span> df</span><span class="token" style="color:#a9b7c6">.</span><span>dropna</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span>
</span><span>  </span><span class="token" style="color:#cc7832">return</span><span> df</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">&#x27;duration&#x27;</span><span class="token" style="color:#a9b7c6">]</span></code></div></pre>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>df </span><span class="token" style="color:#a9b7c6">=</span><span> compute_drawdown_lagoons_durations</span><span class="token" style="color:#a9b7c6">(</span><span>drawdown</span><span class="token" style="color:#a9b7c6">)</span><span>
</span>df
</code></div></pre>
<pre><code>date
2016-12-06     4 days
2016-12-13     4 days
2016-12-27     6 days
2017-01-06    10 days
2017-01-17     6 days
               ...   
2020-08-26     2 days
2020-08-31     5 days
2020-12-28   118 days
2021-01-21    24 days
2021-02-16    21 days
Name: duration, Length: 69, dtype: timedelta64[ns]
</code></pre>
<p>The DataFrame above prints the last day of a drawdown, and its duration in days.</p>
<pre><div style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code class="language-python" style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>df</span><span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#e8bf6a">max</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span><span> df</span><span class="token" style="color:#a9b7c6">.</span><span>mean</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span></code></div></pre>
<pre><code>(Timedelta(&#x27;372 days 00:00:00&#x27;), Timedelta(&#x27;20 days 02:46:57.391304347&#x27;))
</code></pre>
<p>The longest drawdown lasted 372 days! and the average duration of a drawdown was 20 days :)</p>
<p>Stay tuned!</p></div><hr class="mt-4"/><footer></footer></article><nav class="flex flex-wrap justify-between mb-10"><a class="text-lg font-bold" href="/post/from-portfolio-wealth-index-to-index-fund">←<!-- --> <!-- -->From Portfolio Wealth Index to Index Funds</a><a class="text-lg font-bold" href="/post/a-tradeable-investment-portfolio-as-erc20-token">A Tradeable Investment Portfolio as ERC20 Token<!-- --> <!-- -->→</a></nav><div shortname="investingsnippets" config="[object Object]" id="disqus_thread"></div></div><div class="w-full lg:w-1/3 px-2"><div class="border border-dotted mt-4 visible lg:invisible lg:mt-0"></div><div class="my-4 lg:mt-0"><content><h5 class="font-semibold text-lg uppercase text-gray-700">About<!-- --> <!-- -->InvestingSnippets</h5><div class="flex-auto flex-no-wrap flex-shrink-0 text-center pt-5"><a href="https://twitter.com/investingsnipts" class="inline-block hover:text-blue-700 no-label px-2" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="25px"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://github.com/investingsnippets" class="inline-block hover:text-blue-700 no-label px-2" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" width="25px"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://www.linkedin.com/in/investingsnippets/" class="inline-block hover:text-blue-700 no-label px-2" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="25px"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></div><div class="flex items-center my-5"><p class="text-base leading-7">Driven by my passion to always dive deep in new knowledge, I started this blog as an attempt to give my own simplified view on how I apply my Software Engineering skills and background in Mathematics to Investing! NO financial advice or consulting is provided! I use python and try to automate as much as possible.</p></div><div class="flex"><a href="https://twitter.com/investingsnipts" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false"> </a></div></content></div><div class="border border-dotted"></div><div class="my-2 lg:my-4"><content><h5 class="font-semibold text-lg uppercase text-gray-700 mb-2"> Topics </h5><ul><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/topic/investing"><span>Investing</span><span class="text-gray-500 ml-auto">9<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/topic/mathematics"><span>Mathematics</span><span class="text-gray-500 ml-auto">4<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/topic/automation"><span>Automation</span><span class="text-gray-500 ml-auto">2<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li></ul></content></div><div class="border border-dotted"></div><div class="my-2 lg:my-4"><content><h5 class="font-semibold text-lg uppercase text-gray-700 mb-2"> Popular Tags </h5><ul><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/tag/python"><div class="filter-orange-700 h-4 w-4 mr-3 inline-block"><img class="lazyload blur-up" alt="python" data-srcset="https://www.investingsnippets.com/static/python.svg"/></div><span>python</span><span class="text-gray-500 ml-auto">11<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/tag/statistics"><div class="filter-orange-700 h-4 w-4 mr-3 inline-block"><img class="lazyload blur-up" alt="statistics" data-srcset="https://www.investingsnippets.com/static/statistics.svg"/></div><span>statistics</span><span class="text-gray-500 ml-auto">4<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li><li class="p-1 py-4 border-b border-t border-white hover:border-gray-200 transition duration-300"><a class="flex items-center text-gray-600 cursor-pointer" href="/tag/cryptos"><div class="filter-orange-700 h-4 w-4 mr-3 inline-block"><img class="lazyload blur-up" alt="cryptos" data-srcset="https://www.investingsnippets.com/static/bitcoin.svg"/></div><span>cryptos</span><span class="text-gray-500 ml-auto">1<!-- --> <!-- -->articles</span><i class="text-gray-500 bx bx-right-arrow-alt ml-1"></i></a></li></ul></content></div><div class="border border-dotted"></div><div class="my-2 lg:my-4"><content><h5 class="font-semibold text-lg uppercase text-gray-700 mb-2"> Subscribe </h5><p class="text-gray-600">Receive the next blog article directly to your email!</p><form action="https://tinyletter.com/[object Object]" method="post" target="popupwindow"><input type="email" name="email" id="tlemail" title="Email" required="" placeholder="your email address" class="text-gray-700 bg-gray-100 rounded-t hover:outline-none p-2 w-full mt-4 border outline-none"/><input type="hidden" value="1" name="embed"/><button type="submit" class="px-4 py-2 bg-orange-700 text-gray-200 rounded-b w-full capitalize tracking-wide">Subscribe</button></form><p class="text-gray-600 pt-2 text-xs text-center">or, follow the<!-- --> <a href="/feed.xml" class="inline-block hover:text-blue-700 no-label px-2" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" class="svg-inline--fa fa-rss fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="10px"><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg></a></p></content></div><div class="border border-dotted invisible lg:visible"></div></div></main><footer class="border-t py-12 px-2"><div class="flex pb-4"><div class="flex-auto"><h6><a class="font-semibold text-gray-700 mb-4 no-underline" href="/">Home</a></h6></div><div class="flex-auto"><h6><a class="font-semibold text-gray-700 mb-4 no-underline" href="/terms/general-terms">Terms</a></h6></div></div><div class="text-sm my-2 leading-4 text-gray-600">The content, opinions and conclusions on this website are NOT to be construed as financial advice. I always recommend contacting a licensed independent financial advisor. InvestingSnippets assumes no responsibility for any losses, costs or other consequences that may arise from actions or measures taken based on the content of the website. Investing in financial instruments, securities and mutual funds always involves a risk. The instruments can both increase and decrease in value, also as a result of changes in the exchange rate. It is not certain that you will get back the invested capital. Historical returns are no guarantee of future returns.</div><div class="my-2 text-sm text-gray-600">Copyright ©<!-- --> <!-- -->2021<!-- -->,<!-- --> <!-- -->InvestingSnippets</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"frontmatter":{"title":"Drawdown","description":"A great measure of risk indicator.","date":"February 18, 2021","topic":{"id":"investing","name":"Investing","image":"investing.png","description":"The piggy bank digests a good amount of the savings! There is only one way to get away ... investing. BUT, there is a hidden enemy, Speculation!","color":"bg-green-300"},"tags":[{"id":"python","name":"python","image":"python-header.png","description":"Python is very handy in investing","color":"bg-green-300","icon":"python.svg"}],"author":{"id":"chris","name":"Chris","image":"https://s.gravatar.com/avatar/db809ecfa64d56da4bd9704c8393005a?s=80","description":"Software Engineer, passionate about ..."},"img":"/static/drawdown.png","colab":"https://colab.research.google.com/drive/1LFUprI0yMOLPDK4yqgpRAi5sPrGrDhTi?usp=sharing"},"post":{"content":"\nIn a previous [post](/post/from-portfolio-wealth-index-to-index-fund) we talked about the wealth index of an asset as well as a portfolio of assets. The idea of the `wealth index` is very powerful because it represents the cumulative profit of an asset (since it depends on the price returns).\n\nNow, if we have invested 100$ on an asset and we were asked to find the maximum loss, when did that happen and for how long did it last? We need to walk through our wealth index and find all the deeps, then see which one was the largest, when it did happen and when it finally recovered to the previous peak value.\n\nWe employ a well known measure of risk in Investing, called **Drawdown**.\n\n## Computation and Plotting of the Drawdown\n\nFirst the ground code that allows us to fetch stock historical data.\n\n\u003cdetails\u003e\u003csummary\u003ePackage Installation\u003c/summary\u003e\n\u003cp\u003e\n\n```python\n%pip install yahoofinancials\nfrom yahoofinancials import YahooFinancials\nimport pandas as pd\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport dateutil.parser\nimport numpy as np\n```\n\n\u003c/p\u003e\n\u003c/details\u003e\n\n```python\ndef retrieve_stock_data(ticker, start, end):\n    json = YahooFinancials(ticker).get_historical_price_data(start, end, \"daily\")\n    columns=[\"adjclose\"]  # [\"open\",\"close\",\"adjclose\"]\n    df = pd.DataFrame(columns=columns)\n    for row in json[ticker][\"prices\"]:\n        d = dateutil.parser.isoparse(row[\"formatted_date\"])\n        df.loc[d] = [row[\"adjclose\"]] # [row[\"open\"], row[\"close\"], row[\"adjclose\"]]\n    df.index.name = \"date\"\n    df.columns = [ticker]\n    return df\n\ndef normal_rets(S):\n    return S.pct_change().dropna()\n```\n\nI'll randomly pick Apple's (AAPL) stock for this analysis.\n\n```python\napple_stock_prices = retrieve_stock_data(\"AAPL\", \"1990-03-14\", \"2021-02-17\")\napple_rets = normal_rets(apple_stock_prices).dropna()\nfig, (ax1, ax2) = plt.subplots(2, sharex=True, figsize=(14,7))\nfig.suptitle(\"Apple's Price \u0026 Returns\")\napple_stock_prices.plot(ax=ax1, label='Price')\napple_rets.plot(ax=ax2, label='Returns')\nplt.legend(loc=\"upper left\")\nplt.show()\n```\n\n![png](drawdown/drawdown_3_0.png)\n\nSay now that we invested 100$ late 2016. Let's build the wealth index like we did in this [post](/post/from-portfolio-wealth-index-to-index-fund), and find the peaks of the wealth index. That is, the highest generated wealth prices before a deep.\n\n```python\nwealth_index = 100*(1+apple_rets.AAPL[\"12-2016\":]).cumprod()\npeaks = wealth_index.cummax()\nax = wealth_index.plot(figsize=(14,7), label=\"W-Index\")\npeaks.plot(ax=ax, label=\"Peaks\")\nplt.legend(loc=\"upper left\")\nplt.show()\n```\n \n![png](drawdown/drawdown_5_0.png)\n\nDo you see these nice lagoons? Well, we wouldn't want them to be deep and long in duration, cause that is when our investment looses value and we have to wait until it recovers!\n\nSo, moving forward we want to find which lagoon was the deepest, how deep? and how long did it take to move back to the previous peak.\n\nFirst things first, we have to measure at any given point what is the difference between the peak and the wealth index. For example, the peak at a given point is 220\\$ and the index is 150\\$. That means that the index is 70\\$ below the peak. Since our target point is 220\\$ and we have lost 70\\$, we can say that we we are $-\\frac{70}{220}=31.8$% below the target.\n\n```python\ndrawdown =  (wealth_index - peaks)/peaks\ndrawdown.plot(figsize=(14,7), title=\"Drawdown\")\n```\n\n![png](drawdown/drawdown_7_1.png)\n\nThe diagram above is what we call a **Drawdown** of an asset and it doesn't really have to do with any initial investment. Drawdown is a very nice indicator of risk since it is more realistic when compared to other risk indicators that involve standard deviations (Since returns deviate from normality as we proved in [Are Stock Returns Normally Distributed](/post/are-stock-returns-normally-distributed))\n\n## Useful insights from the Drawdown\n\nWe are now ready to find the largest drawdown and the date that occurred. \n\n```python\ndrawdown.min(), drawdown.idxmin()\n```\n    (-0.38515910000506054, Timestamp('2019-01-03 00:00:00'))\n\nWe see that on the 3rd of January 2019 our investment was loosing 38.5% of its value!\n\nOne step further, we will try to find how long the lagoons lasted and find the longest one and an average of their durations.\n\n```python\ndef compute_drawdown_lagoons_durations(drawdown):\n  # find all the locations where the drawdown == 0\n  zero_locations = np.unique(np.r_[(drawdown == 0).values.nonzero()[0], len(drawdown) - 1])\n  # also assign the dates so we know when things were not sinking\n  zero_locations_series = pd.Series(zero_locations, index=drawdown.index[zero_locations])\n  # do a shift to show what is the last and previous non zero dates\n  df = zero_locations_series.to_frame('zero_loc')\n  df['prev_zloc'] = zero_locations_series.shift()\n  # keep only the dates where the difference is more than 1\n  # that denotes the lagoons\n  df = df[df['zero_loc'] - df['prev_zloc'] \u003e 1].astype(int)\n  df['duration'] = df['zero_loc'].map(drawdown.index.__getitem__) - df['prev_zloc'].map(drawdown.index.__getitem__)\n  df = df.reindex(drawdown.index)\n  df = df.dropna()\n  return df['duration']\n```\n\n```python\ndf = compute_drawdown_lagoons_durations(drawdown)\ndf\n```\n    date\n    2016-12-06     4 days\n    2016-12-13     4 days\n    2016-12-27     6 days\n    2017-01-06    10 days\n    2017-01-17     6 days\n                   ...   \n    2020-08-26     2 days\n    2020-08-31     5 days\n    2020-12-28   118 days\n    2021-01-21    24 days\n    2021-02-16    21 days\n    Name: duration, Length: 69, dtype: timedelta64[ns]\n\nThe DataFrame above prints the last day of a drawdown, and its duration in days.\n\n```python\ndf.max(), df.mean()\n```\n    (Timedelta('372 days 00:00:00'), Timedelta('20 days 02:46:57.391304347'))\n\nThe longest drawdown lasted 372 days! and the average duration of a drawdown was 20 days :)\n\nStay tuned!\n","excerpt":""},"previousPost":{"slug":"from-portfolio-wealth-index-to-index-fund","frontmatter":{"title":"From Portfolio Wealth Index to Index Funds","description":"Ever wandered how an index fund is built? In this post we build a primitive one step by step.","date":"February 5, 2021","topic":{"id":"investing","name":"Investing","image":"investing.png","description":"The piggy bank digests a good amount of the savings! There is only one way to get away ... investing. BUT, there is a hidden enemy, Speculation!","color":"bg-green-300"},"tags":[{"id":"python","name":"python","image":"python-header.png","description":"Python is very handy in investing","color":"bg-green-300","icon":"python.svg"}],"author":{"id":"chris","name":"Chris","image":"https://s.gravatar.com/avatar/db809ecfa64d56da4bd9704c8393005a?s=80","description":"Software Engineer, passionate about ..."},"img":"/static/hacking-index-funds.png","colab":"https://colab.research.google.com/drive/1tPuqAsHgQdIYhSbaaoCS9LjEayDrTwjX?usp=sharing"},"excerpt":"","content":"\nImagine a scenario where you have invested 100$ in a stock the last 3 years and you earned 20% in the 1st year, -10% in the 2nd year, and 11% in the 3rd year. You would like to see how the investment progressed over the time until today.\n\nWe have already discussed about [geometric progression and the  compounding of returns](/post/geometric-progression-and-compounding-of-returns) in a previous article, and we will use that knowledge even further here.\n\nSo, at the end of the 3rd year, the investment would be:\n\n$$\n100 × 1.2 × .9 × 1.11 = 119.88\n$$\n\nIn the case of an initial investment of 1$, the result above would be called `Cumulative Wealth Index`!\n\nLet me show you how this index progresses over time.\n\nAt first we set the ground work for fetching historical prices.\n\n\u003cdetails\u003e\u003csummary\u003ePackage Installation\u003c/summary\u003e\n\u003cp\u003e\n\n```python\n%pip install yahoofinancials\nfrom yahoofinancials import YahooFinancials\nimport pandas as pd\nimport matplotlib\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport dateutil.parser\nimport numpy as np\n```\n\n\u003c/p\u003e\n\u003c/details\u003e\n\n```python\ndef retrieve_stock_data(ticker, start, end):\n    json = YahooFinancials(ticker).get_historical_price_data(start, end, \"daily\")\n    columns=[\"adjclose\"]  # [\"open\",\"close\",\"adjclose\"]\n    df = pd.DataFrame(columns=columns)\n    for row in json[ticker][\"prices\"]:\n        d = dateutil.parser.isoparse(row[\"formatted_date\"])\n        df.loc[d] = [row[\"adjclose\"]] # [row[\"open\"], row[\"close\"], row[\"adjclose\"]]\n    df.index.name = \"date\"\n    df.columns = [ticker]\n    return df\n\ndef normal_rets(S):\n    return S.pct_change().dropna()\n```\n\nSay, we have invested 100$ in the MSFT stock on the 11th of October 2019. Earlier we used annualized returns, but for this example we will use the daily returns.\n\nBelow we will download the stock prices for the aforementioned period and calculate the daily returns.\n\n```python\nmsft_stock_prices = retrieve_stock_data(\"MSFT\", \"2019-10-11\", \"2021-02-04\")\nmsft_rets = normal_rets(msft_stock_prices).dropna()\nmsft_rets.head()\n```\n\n\u003cdiv\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eMSFT\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003edate\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-14\u003c/th\u003e\n      \u003ctd\u003e-0.000931\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-15\u003c/th\u003e\n      \u003ctd\u003e0.014475\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-16\u003c/th\u003e\n      \u003ctd\u003e-0.008194\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-17\u003c/th\u003e\n      \u003ctd\u003e-0.005128\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-18\u003c/th\u003e\n      \u003ctd\u003e-0.016322\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\nThen, we will build the cumulative wealth index based on the initial investment, over time.\n\n```python\n# See equation (1) in the post about geometric progression and the \n# compounding of returns\nwealth_index = 100 * (1 + msft_rets).cumprod() \nwealth_index.head()\n```\n\n\u003cdiv\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eMSFT\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003edate\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-14\u003c/th\u003e\n      \u003ctd\u003e99.906939\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-15\u003c/th\u003e\n      \u003ctd\u003e101.353104\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-16\u003c/th\u003e\n      \u003ctd\u003e100.522643\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-17\u003c/th\u003e\n      \u003ctd\u003e100.007156\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-18\u003c/th\u003e\n      \u003ctd\u003e98.374868\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\nAnd let's see how it looks like\n\n```python\nf, (ax1, ax2) = plt.subplots(1, 2, sharex=True)\nmsft_stock_prices.plot(ax=ax1, figsize=(14,7))\nwealth_index.plot(ax=ax2)\nax1.get_legend().remove()\nax2.get_legend().remove()\nax1.title.set_text('MSFT Price Chart')\nax2.title.set_text('Cumulative Wealth Index')\nplt.show()\n```\n  \n![png](from-portfolio-wealth-index-to-index-fund/from-portfolio-wealth-index-to-index-fund_7_0.png)\n\nThere are a few things to notice in the graphs above:\n\n* The price development is the same :) and that makes sense, since the actual investment follows the price move of the stock.\n* The start point is different. Since we invested only 100\\$ and not ~140$ (the price of one stock at the moment).\n* The wealth index cares about the daily returns and not the actual price of the asset.\n\nThis last bullet allows us to extend the previous scenario by including more assets in our investment without taking into account the prices of the assets, but only the returns.\n\n## Portfolio Cumulative Wealth Index\n\nI will simplify how a primitive index fund (or Mutual Fund or an ETF) is built by extending the process from the previous section.\n\nSay now that, instead of investing 100$ to MSFT, we split the amount into 4 equal parts and we buy 4 different stocks. I will randomly pick Google's, Tesla's and Paypal's stocks.\n\n```python\nfrom functools import reduce\ngoogle_stock_prices = retrieve_stock_data(\"GOOGL\", \"2019-10-11\", \"2021-02-04\")\ngoogle_rets = normal_rets(google_stock_prices).dropna()\n\ntsla_stock_prices = retrieve_stock_data(\"TSLA\", \"2019-10-11\", \"2021-02-04\")\ntsla_rets = normal_rets(tsla_stock_prices).dropna()\n\npaypal_stock_prices = retrieve_stock_data(\"PYPL\", \"2019-10-11\", \"2021-02-04\")\npaypal_rets = normal_rets(paypal_stock_prices).dropna()\n\n# bring them all together in a single dataframe\nassets_returns = reduce(lambda left,right: left.merge(right, left_index=True, right_index=True),\n            [msft_rets, google_rets, tsla_rets, paypal_rets])\nassets_returns.head()\n```\n\n\u003cdiv\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eMSFT\u003c/th\u003e\n      \u003cth\u003eGOOGL\u003c/th\u003e\n      \u003cth\u003eTSLA\u003c/th\u003e\n      \u003cth\u003ePYPL\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003edate\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-14\u003c/th\u003e\n      \u003ctd\u003e-0.000931\u003c/td\u003e\n      \u003ctd\u003e0.001695\u003c/td\u003e\n      \u003ctd\u003e0.036589\u003c/td\u003e\n      \u003ctd\u003e0.001674\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-15\u003c/th\u003e\n      \u003ctd\u003e0.014475\u003c/td\u003e\n      \u003ctd\u003e0.020094\u003c/td\u003e\n      \u003ctd\u003e0.003619\u003c/td\u003e\n      \u003ctd\u003e0.018084\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-16\u003c/th\u003e\n      \u003ctd\u003e-0.008194\u003c/td\u003e\n      \u003ctd\u003e0.000612\u003c/td\u003e\n      \u003ctd\u003e0.007212\u003c/td\u003e\n      \u003ctd\u003e-0.004827\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-17\u003c/th\u003e\n      \u003ctd\u003e-0.005128\u003c/td\u003e\n      \u003ctd\u003e0.007884\u003c/td\u003e\n      \u003ctd\u003e0.008547\u003c/td\u003e\n      \u003ctd\u003e0.005238\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-18\u003c/th\u003e\n      \u003ctd\u003e-0.016322\u003c/td\u003e\n      \u003ctd\u003e-0.006697\u003c/td\u003e\n      \u003ctd\u003e-0.019163\u003c/td\u003e\n      \u003ctd\u003e-0.023256\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\nBased on the weight allocation of [.25, .25, .25, .25], let us now find the new cumulative wealth index of the investment.\n\n```python\n# since the weights stay same throughout the index and since 100*0.25 = 25\nportfolio_wealth_index = 25 * (1 + assets_returns).cumprod()\nportfolio_wealth_index.head()\n```\n\n\u003cdiv\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eMSFT\u003c/th\u003e\n      \u003cth\u003eGOOGL\u003c/th\u003e\n      \u003cth\u003eTSLA\u003c/th\u003e\n      \u003cth\u003ePYPL\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003edate\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003e\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-14\u003c/th\u003e\n      \u003ctd\u003e24.976735\u003c/td\u003e\n      \u003ctd\u003e25.042363\u003c/td\u003e\n      \u003ctd\u003e25.914720\u003c/td\u003e\n      \u003ctd\u003e25.041838\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-15\u003c/th\u003e\n      \u003ctd\u003e25.338276\u003c/td\u003e\n      \u003ctd\u003e25.545567\u003c/td\u003e\n      \u003ctd\u003e26.008512\u003c/td\u003e\n      \u003ctd\u003e25.494683\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-16\u003c/th\u003e\n      \u003ctd\u003e25.130661\u003c/td\u003e\n      \u003ctd\u003e25.561196\u003c/td\u003e\n      \u003ctd\u003e26.196096\u003c/td\u003e\n      \u003ctd\u003e25.371627\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-17\u003c/th\u003e\n      \u003ctd\u003e25.001789\u003c/td\u003e\n      \u003ctd\u003e25.762725\u003c/td\u003e\n      \u003ctd\u003e26.419986\u003c/td\u003e\n      \u003ctd\u003e25.504527\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2019-10-18\u003c/th\u003e\n      \u003ctd\u003e24.593717\u003c/td\u003e\n      \u003ctd\u003e25.590192\u003c/td\u003e\n      \u003ctd\u003e25.913712\u003c/td\u003e\n      \u003ctd\u003e24.911400\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e\n\nNow, we just fave to sum the columns per row and plot the result\n\n```python\nportfolio_wealth_index.sum(axis=1).plot.line(figsize=(14,7))\nplt.title('4 Asset Index')\nplt.show()\n```\n\n![png](from-portfolio-wealth-index-to-index-fund/from-portfolio-wealth-index-to-index-fund_13_0.png)\n\n## Index/Mutual/Exchange-Traded Funds\n\nIn the example above, I chose some random assets and equally weighted them in a portfolio! However, even simplistic, this is how a traded fund looks like.\n\nIn practice, a fund is a bucket of assets weighted in a structured way, and initialized with a price (like i did above with the 100$). Then, they are offered in the stock exchange for purchasing. In our example above, if it was a traded fund, the investors would deposit money to the fund and the fund would buy the underlying assets based on the specified weights. The buying and selling of the fund, doesn't affect the price of the fund directly (but indirectly through the underlying assets).\n\nThe difference among the different types of funds is due to the way weights are calculated. Mutual and ETFs have managers that pick these weights based on market research, and other characteristics. The managers, can change the weights by performing a rebalancing of the portfolio.\n\nIn index funds (also known as passive ETFs) the weights are usually based on market cap and maybe other attributes and require minimum intervention from a manager (and due to that are normally much cheaper than the other types of funds). In the simplest case, an index fund could follow all the assets of a specific industry and allocate the weights according to the market capitalization of each asset (divided by the total market cap of all the assets in the index) or just follow the same weighting strategy of a well known index, such as S\u0026P 500.\n\nIn future posts, I will try to build (and invent) different types of funds.\n\nUntil next time!\n"},"nextPost":{"slug":"a-tradeable-investment-portfolio-as-erc20-token","frontmatter":{"title":"A Tradeable Investment Portfolio as ERC20 Token","description":"Building a simple portfolio on Ethereum blockchain as an ERC20 token.","date":"February 21, 2021","topic":{"id":"automation","name":"Automation","image":"automation.jpg","description":"Spending time to do the same thing over and over again is tedious! Thus, I like to automate as much as possible.","color":"bg-green-300"},"tags":[{"id":"cryptos","name":"cryptos","image":"bitcoin.png","description":"The amazing world of Blockchain opens one more chapter in the Investing.","color":"bg-green-300","icon":"bitcoin.svg"}],"author":{"id":"chris","name":"Chris","image":"https://s.gravatar.com/avatar/db809ecfa64d56da4bd9704c8393005a?s=80","description":"Software Engineer, passionate about ..."},"img":"/static/erc20-exchange.png"},"excerpt":"","content":"\nIn a previous post we discussed how it is possible to create a [simple index fund by combining several tradeable assets](/post/from-portfolio-wealth-index-to-index-fund). We also mentioned that such a portfolio can be traded on the secondary market as a basic ETF. \n\nSuch a scenario is pretty difficult to achieve since special licenses and time consuming actions are needed. However, it is fairly easy to do on the Ethereum blockchain!\n\nThis is what we will try to showcase in this article. We will build a very simple contract that keeps information about a fictional portfolio of other tokens.\n\nIn its extended form, every time someone purchases this token, the amount invested, will be used to purchase the tokens listed in the portfolio based on their weights, and as such, it will follow the development of these tokens (like the index fund we described in the other article).\n\nBelow is a screenshot of the end result. The code is published on [github](https://github.com/investingsnippets/tradeable-investment-portfolio-as-erc20-token).\n\n![png](a-tradeable-investment-portfolio-as-erc20-token/portfolio-token.png)\n\n## Introduction to Ethereum Tokens\n\nI will not go deep into how Ethereum works, since it is a huge topic. We can describe it as a decentralized computer which can execute instructions in a distributed manner. These instructions are simple computer programs (code) that perform a specific job. This program is what we call `An Ethereum Smart Contract`. \n\nThe distributed manner of the contract execution is achieved by the nodes on a blockchain :). That means that the program once might run on a node (server) in USA and the next moment on a node in China. Traditionally, we were used to programs running on a limited number of nodes (e.g. on the cloud), that we managed by a single entity (e.g. cloud provider, company datacenter). However, in the blockchain case, the nodes are just another user terminal (e.g. a server at home, our laptops, etc.).\n\nOn another side, a blockchain solves the well known `double spending` problem (which we will analyze in another post) and due to that, it can be used as an exchange mechanism for digital currencies! Combining these two aspects together, we achieve tradeable contracts (digital assets), which we generally call tokens (they can hold a balance, have a defined supply amount, and can be transferred).\n\nAs an example, imagine a digital currency where you are able to program it with something like. If, the user solves a puzzle on the internet, wins one coin! Or, if the user deposits purchases the coin with some \\$, then these \\$ will be used to purchase other coins and hold them locked in the initial coin, until the owner decides to sell the coin and as a consequence sell the subsequent coins! \n\nNow, the contract creation usually follows some coding principles and is implemented using a programming language. This language is called [Solidity](https://docs.soliditylang.org/en/v0.8.1/) (on Ethereum) and the principles are called standards. ERC20 is such a standard and allows for a digital currency/token creation!\n\nThe tokens can be used in many different ways, which I will describe in a future post. For now we will focus on the creation of digital currency feature.\n\n## The contract\n\nBelow I'm pasting the simplified version of the contract with inlined comments.\n\n```javascript\n// define the solidity compiler version to be used\npragma solidity 0.6.10;\n// additional functionalities for passing around structs  \npragma experimental \"ABIEncoderV2\";\n\n// We use openzeppelin library which provides proper interfaces and\n// solves lot's of boilerplate work we would do otherwise.\nimport { Address } from \"@openzeppelin/contracts/utils/Address.sol\";\nimport { ERC20 } from \"@openzeppelin/contracts/token/ERC20/ERC20.sol\";\nimport { SafeMath } from \"@openzeppelin/contracts/math/SafeMath.sol\";\nimport { SignedSafeMath } from \"@openzeppelin/contracts/math/SignedSafeMath.sol\";\n\n// We define the name of the contract and specify that is an ERC20 token\ncontract PortfolioToken is ERC20 {\n    using Address for address;\n    using SafeMath for uint256;\n    using SignedSafeMath for int256;\n\n    // the user who creates the contract is also the administrator\n    address PortfolioManager;\n\n    // the asset definition\n    struct Asset {\n        uint8 weight; // weight in the Portfolio\n        uint timeStamp; // last updated\n        string name; // name of the asset. For the purposes of the example, since tokens can have the same name\n        string symbol; // symbol of the asset. Also, the symbol of a token can be the same among tokens :(\n    }\n\n    mapping ( address =\u003e Asset ) assets; // this allows to store tokens by their ethereum address\n    address[] public allAssets; // a directory of all the token addresses in the fund\n    mapping(address =\u003e bool) public isResource; // for validation purposes\n\n    // the initial price of the token\n    int256 private strikePrice;\n\n    // the contsrucor of the token will be called when deploying the contract\n    constructor(\n        int256 _strikePrice,\n        string memory _name,\n        string memory _symbol\n    )\n        public\n        ERC20(_name, _symbol)\n    {\n        PortfolioManager = msg.sender;\n        strikePrice = _strikePrice;\n    }\n\n    modifier onlyManager() {\n        _validateOnlyManager();\n        _;\n    }\n\n    function mint(address _account, uint256 _quantity) public {\n        _mint(_account, _quantity);\n    }\n\n    // the main method used to add an asset to the portfolio\n    function addAsset(address _assetAddress, uint8 _weight, string memory _name, string memory _symbol) external onlyManager {\n        require(!isResource[_assetAddress], \"Asset already exists\"); // not adding true/false val in struct to save gas\n        assets[_assetAddress].weight = _weight;\n        assets[_assetAddress].name = _name;\n        assets[_assetAddress].symbol = _symbol;\n        assets[_assetAddress].timeStamp = block.timestamp;\n        isResource[_assetAddress] = true;\n        allAssets.push(_assetAddress);\n    }\n\n    // edits an asset's weight\n    function editAsset(address _assetAddress, uint8 _weight) external onlyManager {\n        assets[_assetAddress].weight = _weight;\n        assets[_assetAddress].timeStamp = block.timestamp;\n    }\n\n    // removes an asset from the portfolio\n    function removeAsset(address _assetAddress) external onlyManager {\n        delete assets[_assetAddress];\n        // allAssets = allAssets.remove(_assetAddress);\n        isResource[_assetAddress] = false;\n    }\n\n    // returns a list of assets in the portfolio\n    function getAssets() external view returns(address[] memory) {\n        return allAssets;\n    }\n\n    // return the info of an asset by passing the address of it\n    function getAssetInfo(address _assetAddress) external view returns(string memory name, string memory symbol, uint8 weight, uint timeStamp) {\n        return (assets[_assetAddress].name, assets[_assetAddress].symbol, assets[_assetAddress].weight, assets[_assetAddress].timeStamp);\n    } \n\n    function _validateOnlyManager() internal view {\n        require(msg.sender == PortfolioManager, \"Only manager has access\");\n    }\n}\n```\n\n## How to try it out\n\n\u003e Note: Make sure that MetaMask is either disabled, or configured to use the local blockchain. OR, use browser in incognito mode. Be extra careful! (you have been warned ;))\n\nFor this project I have used:\n\n* ganache, which provides a local Ethereum blockchain.\n* truffle, which provides tooling to compile, test and deploy contracts\n* drizzle, which implements client side interaction with the contract (through web3.js)\n* react, for building a simple web application to be able to graphically interact with the contract\n\nTo run the example, clone the [github repo](https://github.com/investingsnippets/tradeable-investment-portfolio-as-erc20-token) and make sure that docker is installed on your machine.\n\nThen, use the command\n\n```bash\ndocker-compose run -p \"3000:3000\" -p \"8545:8545\" --rm develop\n```\n\nwhich starts everything needed in docker and exposes the web app on port 3000!\n\nJust visit `http://localhost:3000/` on your browser and experiment with the app.\n"}},"tags":[{"id":"python","name":"python","image":"python-header.png","description":"Python is very handy in investing","color":"bg-green-300","icon":"python.svg","slug":"python","count":11},{"id":"statistics","name":"statistics","image":"statistics.jpg","description":"Statistics is the discipline that concerns the collection, organization, analysis, interpretation and presentation of data. - Wikipedia","color":"bg-green-300","icon":"statistics.svg","slug":"statistics","count":4},{"id":"cryptos","name":"cryptos","image":"bitcoin.png","description":"The amazing world of Blockchain opens one more chapter in the Investing.","color":"bg-green-300","icon":"bitcoin.svg","slug":"cryptos","count":1}],"sortedTopics":[{"id":"investing","name":"Investing","image":"investing.png","description":"The piggy bank digests a good amount of the savings! There is only one way to get away ... investing. BUT, there is a hidden enemy, Speculation!","color":"bg-green-300","slug":"investing","count":9},{"id":"mathematics","name":"Mathematics","image":"mathematics.png","description":"Investing, as part of the Science of Finance, is subject to the lows of Mathematics!","color":"bg-green-300","slug":"mathematics","count":4},{"id":"automation","name":"Automation","image":"automation.jpg","description":"Spending time to do the same thing over and over again is tedious! Thus, I like to automate as much as possible.","color":"bg-green-300","slug":"automation","count":2}],"allTopics":[{"id":"mathematics","name":"Mathematics","image":"mathematics.png","description":"Investing, as part of the Science of Finance, is subject to the lows of Mathematics!","color":"bg-green-300"},{"id":"automation","name":"Automation","image":"automation.jpg","description":"Spending time to do the same thing over and over again is tedious! Thus, I like to automate as much as possible.","color":"bg-green-300"},{"id":"investing","name":"Investing","image":"investing.png","description":"The piggy bank digests a good amount of the savings! There is only one way to get away ... investing. BUT, there is a hidden enemy, Speculation!","color":"bg-green-300"}],"slug":"drawdown"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"drawdown"},"buildId":"zqd2oJuASv7eQ57fHqll2","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-6d6446214035a37ee7d9.js"></script><script src="/_next/static/chunks/main-9b805fa25f3c727dff23.js" async=""></script><script src="/_next/static/chunks/webpack-eb080e3f091731f228fb.js" async=""></script><script src="/_next/static/chunks/framework.1d36bc031662b4dc4c28.js" async=""></script><script src="/_next/static/chunks/aafb98ef.d6f2610c02ca1f2f8023.js" async=""></script><script src="/_next/static/chunks/commons.8953387921da877f7077.js" async=""></script><script src="/_next/static/chunks/c993a675fc23e2c5b16b0cdfa51e09fd2f5f8f80.7eda6f7f6f606b39097e.js" async=""></script><script src="/_next/static/chunks/pages/_app-8d389892d8851416e9e3.js" async=""></script><script src="/_next/static/chunks/cb1608f2.374587486deb2a784e19.js" async=""></script><script src="/_next/static/chunks/a9a7754c.d9f31489d713bac24f81.js" async=""></script><script src="/_next/static/chunks/60273576.45a211ac3b19a5bdcfc0.js" async=""></script><script src="/_next/static/chunks/28b78d933298d505941537c6c1190f6a19d63af1.41b7ccb1b9a7b85862b6.js" async=""></script><script src="/_next/static/chunks/f485e41bcb118a628b46c21556cf62824a9a6265.b5d54d4427b3ca2aa455.js" async=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-97291d7a14d13b3eb33a.js" async=""></script><script src="/_next/static/zqd2oJuASv7eQ57fHqll2/_buildManifest.js" async=""></script><script src="/_next/static/zqd2oJuASv7eQ57fHqll2/_ssgManifest.js" async=""></script></body></html>